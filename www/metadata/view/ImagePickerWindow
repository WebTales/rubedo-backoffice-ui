{
    "type": "Ext.window.Window",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "localiserId": "damPickerWindow",
        "height": 406,
        "id": "ImagePickerWindow",
        "width": 600,
        "designer|userClassName": "ImagePickerWindow",
        "designer|userAlias": "ImagePickerWindow",
        "layout": "fit",
        "title": "Choix DAM",
        "constrainHeader": true,
        "maximizable": null,
        "modal": true
    },
    "designerId": "529b2508-9046-4453-930b-c1aa11abce73",
    "customConfigs": [
        {
            "group": "(Custom Properties)",
            "name": "localiserId",
            "type": "string"
        }
    ],
    "cn": [
        {
            "type": "basiceventbinding",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onImagePickerWindowRender",
                "implHandler": [
                    "Ext.getStore(\"DAMPickerStore\").clearFilter(true);\r",
                    "Ext.getStore('TaxonomyForDam2').load();\r",
                    "var allowedTypes=Ext.getCmp(component.targetField).allowedDAMTypes;\r",
                    "if ((!Ext.isEmpty(allowedTypes))&&(!Ext.isArray(allowedTypes))){\r",
                    "    allowedTypes=[allowedTypes];\r",
                    "}\r",
                    "this.allowedTypes=allowedTypes;\r",
                    "var allowedFileType=Ext.getCmp(component.targetField).allowedFileType;\r",
                    "var columnsOver= [\r",
                    "{\r",
                    "    xtype: 'gridcolumn',\r",
                    "    filter: true,\r",
                    "    dataIndex: 'title',\r",
                    "    text: 'Titre'\r",
                    "},\r",
                    "{\r",
                    "    xtype: 'gridcolumn',\r",
                    "    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {\r",
                    "        return(value.fullName);\r",
                    "    },\r",
                    "    dataIndex: 'createUser',\r",
                    "    text: 'Auteur'\r",
                    "},\r",
                    "{\r",
                    "    xtype: 'datecolumn',\r",
                    "    dataIndex: 'createTime',\r",
                    "    text: 'Date de création',\r",
                    "    format: 'd-m-Y'\r",
                    "}\r",
                    "];\r",
                    "if (Ext.isEmpty(allowedTypes)){\r",
                    "    if (Ext.isEmpty(allowedFileType)){\r",
                    "        delete Ext.getStore(\"MediaTypesFORDAMPicker\").getProxy().extraParams.filter;\r",
                    "        Ext.getStore(\"MediaTypesFORDAMPicker\").load();\r",
                    "        columnsOver.push({\r",
                    "            xtype:'gridcolumn',\r",
                    "            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {\r",
                    "                if (Ext.isEmpty(Ext.getStore(\"MediaTypesFORDAMPicker\").findRecord(\"id\",value))) {\r",
                    "                    return(value);\r",
                    "                } else {\r",
                    "                    return(Ext.getStore(\"MediaTypesFORDAMPicker\").findRecord(\"id\",value).get(\"type\"));\r",
                    "                }\r",
                    "            },\r",
                    "            filter: {\r",
                    "                type: 'combo',\r",
                    "                valueField: 'id',\r",
                    "                id:'chooseMTInPickerCombo',\r",
                    "                displayField: 'type',\r",
                    "                store: 'MediaTypesFORDAMPicker'\r",
                    "            },\r",
                    "            dataIndex: 'typeId',\r",
                    "\r",
                    "            text: 'Type'\r",
                    "        });\r",
                    "        delete Ext.getStore(\"DAMPickerStore\").getProxy().extraParams.tFilter;\r",
                    "        Ext.getStore(\"DAMPickerStore\").load();   \r",
                    "    } else {\r",
                    "        Ext.getStore(\"MediaTypesFORDAMPicker\").getProxy().extraParams.filter=\"[{\\\"property\\\":\\\"mainFileType\\\",\\\"value\\\":\\\"\"+allowedFileType+\"\\\"}]\";\r",
                    "        Ext.getStore(\"MediaTypesFORDAMPicker\").load();\r",
                    "        columnsOver.push({\r",
                    "            xtype:'gridcolumn',\r",
                    "            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {\r",
                    "                if (Ext.isEmpty(Ext.getStore(\"MediaTypesFORDAMPicker\").findRecord(\"id\",value))) {\r",
                    "                    return(value);\r",
                    "                } else {\r",
                    "                    return(Ext.getStore(\"MediaTypesFORDAMPicker\").findRecord(\"id\",value).get(\"type\"));\r",
                    "                }\r",
                    "            },\r",
                    "            filter: {\r",
                    "                type: 'combo',\r",
                    "                valueField: 'id',\r",
                    "                displayField: 'type',\r",
                    "                id:'chooseMTInPickerCombo',\r",
                    "                store: 'MediaTypesFORDAMPicker'\r",
                    "            },\r",
                    "            dataIndex: 'typeId',\r",
                    "\r",
                    "            text: 'Type'\r",
                    "        });\r",
                    "        Ext.getStore(\"DAMPickerStore\").getProxy().extraParams.tFilter=\"[{\\\"property\\\":\\\"mainFileType\\\",\\\"value\\\":\\\"\"+allowedFileType+\"\\\"}]\";\r",
                    "        Ext.getStore(\"DAMPickerStore\").load();\r",
                    "    }\r",
                    "}else if (allowedTypes.length==1){\r",
                    "    Ext.getStore(\"DAMPickerStore\").getProxy().extraParams.tFilter=\"[{\\\"property\\\":\\\"typeId\\\",\\\"value\\\":\\\"\"+allowedTypes[0]+\"\\\"}]\";\r",
                    "    Ext.getStore(\"DAMPickerStore\").load();\r",
                    "    Ext.getStore(\"MediaTypesFORDAMPicker\").getProxy().extraParams.filter=\"[{\\\"property\\\":\\\"id\\\",\\\"operator\\\":\\\"$in\\\",\\\"value\\\":\"+Ext.JSON.encode(allowedTypes)+\"}]\";\r",
                    "    Ext.getStore(\"MediaTypesFORDAMPicker\").load();\r",
                    "} else {\r",
                    "    Ext.getStore(\"MediaTypesFORDAMPicker\").getProxy().extraParams.filter=\"[{\\\"property\\\":\\\"id\\\",\\\"operator\\\":\\\"$in\\\",\\\"value\\\":\"+Ext.JSON.encode(allowedTypes)+\"}]\";\r",
                    "    Ext.getStore(\"MediaTypesFORDAMPicker\").load();\r",
                    "    columnsOver.push({\r",
                    "        xtype:'gridcolumn',\r",
                    "        renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {\r",
                    "            if (Ext.isEmpty(Ext.getStore(\"MediaTypesFORDAMPicker\").findRecord(\"id\",value))) {\r",
                    "                return(value);\r",
                    "            } else {\r",
                    "                return(Ext.getStore(\"MediaTypesFORDAMPicker\").findRecord(\"id\",value).get(\"type\"));\r",
                    "            }\r",
                    "        },\r",
                    "        filter: {\r",
                    "            type: 'combo',\r",
                    "            valueField: 'id',\r",
                    "            displayField: 'type',\r",
                    "            store: 'MediaTypesFORDAMPicker'\r",
                    "        },\r",
                    "        dataIndex: 'typeId',\r",
                    "\r",
                    "        text: 'Type'\r",
                    "    });\r",
                    "\r",
                    "    Ext.getStore(\"DAMPickerStore\").getProxy().extraParams.tFilter=\"[{\\\"property\\\":\\\"typeId\\\",\\\"operator\\\":\\\"$in\\\",\\\"value\\\":\"+Ext.JSON.encode(allowedTypes)+\"}]\";\r",
                    "    Ext.getStore(\"DAMPickerStore\").load();\r",
                    "}\r",
                    "var DAMPicker = Ext.widget(\"DAMMainView\", {id:\"DAMPickerView\", store:Ext.getStore(\"DAMPickerStore\"),columns:columnsOver, multiSelect:false, plugins:[\r",
                    "    Ext.create('Ext.ux.grid.FilterBar', {renderHidden: false, showShowHideButton: true,showClearAllButton: true})\r",
                    "\r",
                    "    ], features: [Ext.create('Ext.ux.grid.feature.Tileview', {\r",
                    "        viewMode: 'tileIcons',\r",
                    "        getAdditionalData: function(data, index, record, orig)\r",
                    "        {\r",
                    "\r",
                    "\r",
                    "\r",
                    "            generateThumbnail = function()\r",
                    "            {\r",
                    "                return \"dam/get-thumbnail?id=\"+record.get(\"id\");\r",
                    "            };\r",
                    "\r",
                    "            if(this.viewMode)\r",
                    "            {\r",
                    "                return {\r",
                    "                    thumbnails: generateThumbnail(),\r",
                    "                    author:record.get(\"createUser\").fullName,\r",
                    "                    date: Ext.Date.format(record.get(\"createTime\"), 'd-m-Y'),\r",
                    "                    filename:record.get(\"title\"),\r",
                    "                    fileSize:Ext.util.Format.fileSize(record.get(\"fileSize\"))\r",
                    "                };\r",
                    "            }\r",
                    "            return {};\r",
                    "        },\r",
                    "        viewTpls:\r",
                    "        {\r",
                    "            mediumIcons: [\r",
                    "            '<td class=\"{cls} ux-explorerview-medium-icon-row\">',\r",
                    "            '<table class=\"x-grid-row-table\">',\r",
                    "            '<tbody>',\r",
                    "            '<tr>',\r",
                    "            '<td class=\"x-grid-col x-grid-cell ux-explorerview-icon\" style=\"background: transparent;\">',\r",
                    "            '<img src=\\\"{thumbnails}\\\" height=\\\"100\\\" width=\\\"100\\\">',\t\t\t\r",
                    "            '</td>',\r",
                    "            '</tr>',\r",
                    "            '<tr>',\r",
                    "            '<td class=\"x-grid-col x-grid-cell\">',\r",
                    "            '<div class=\"x-grid-cell-inner\" unselectable=\"on\">{filename}</div>',\r",
                    "            '</td>',\r",
                    "            '</tr>',\r",
                    "            '</tbody>',\r",
                    "            '</table>',\r",
                    "            '</td>'].join(''),\r",
                    "\r",
                    "            tileIcons: [\r",
                    "            '<td class=\"{cls} ux-explorerview-detailed-icon-row\">',\r",
                    "            '<table class=\"x-grid-row-table\">',\r",
                    "            '<tbody>',\r",
                    "            '<tr>',\r",
                    "            '<td class=\"x-grid-col x-grid-cell ux-explorerview-icon\" style=\"background: transparent;\">',\r",
                    "            '<img src=\\\"{thumbnails}\\\" height=\\\"50\\\" width=\\\"50\\\">',\t\t\t\r",
                    "            '</td>',\r",
                    "\r",
                    "            '<td class=\"x-grid-col x-grid-cell\">',\r",
                    "            '<div class=\"x-grid-cell-inner\" unselectable=\"on\">{filename}<br><span>{fileSize}<br>{author}<br>{date}</span></div>',\r",
                    "            '</td>',\r",
                    "            '</tr>',\r",
                    "            '</tbody>',\r",
                    "            '</table>',\r",
                    "            '</td>'].join('')\r",
                    "\r",
                    "        }\r",
                    "    }),\r",
                    "    {\r",
                    "        ftype: 'grouping',\r",
                    "        groupHeaderTpl: '{name} ({rows.length} Item{[values.rows.length > 1 ? \"s\" : \"\"]})',\r",
                    "        disabled: false\r",
                    "    }],\r",
                    "    tbar: [{},'->', {\r",
                    "    xtype: 'switchbuttonsegment',\r",
                    "    activeItem: 1,\r",
                    "    scope: this,\r",
                    "    items: [{\r",
                    "        tooltip: 'Details',\r",
                    "        viewMode: 'default',\r",
                    "        iconCls: 'icon-default'\r",
                    "    }, {\r",
                    "        tooltip: 'Tiles',\r",
                    "        viewMode: 'tileIcons',\r",
                    "        iconCls: 'icon-tile'\r",
                    "    }, {\r",
                    "        tooltip: 'Icons',\r",
                    "        viewMode: 'mediumIcons',\r",
                    "        iconCls: 'icon-medium'\r",
                    "    }],\r",
                    "    listeners: {\r",
                    "        change: function(btn, item)\r",
                    "        {\r",
                    "            btn.up().up().up().features[0].setView(btn.viewMode);\t\t\r",
                    "        },\r",
                    "        scope: this\r",
                    "    }\r",
                    "}\r",
                    "]});\r",
                    "DAMPicker.on(\"selectionchange\", function(g, s){\r",
                    "if (Ext.isEmpty(s)){\r",
                    "    Ext.getCmp(\"imagePickerAcceptBtn\").disable();\r",
                    "} else {\r",
                    "    Ext.getCmp(\"imagePickerAcceptBtn\").enable();\r",
                    "}\r",
                    "});\r",
                    "DAMPicker.on(\"itemdblclick\", function(){\r",
                    "try{\r",
                    "    Ext.getCmp(\"imagePickerAcceptBtn\").fireEvent(\"click\",Ext.getCmp(\"imagePickerAcceptBtn\"));\r",
                    "} catch(err){}\r",
                    "});\r",
                    "\r",
                    "\r",
                    "component.add(DAMPicker);"
                ],
                "name": "render",
                "scope": "me"
            },
            "designerId": "c5d8bf98-04ca-4bc5-acdf-f03b207127ae"
        },
        {
            "type": "basiceventbinding",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onImagePickerWindowBeforeClose",
                "implHandler": [
                    "Ext.getStore(\"DAMPickerStore\").removeAll();\r",
                    "Ext.getStore(\"DAMPickerStore\").clearFilter(true);\r",
                    "Ext.getStore(\"MediaTypesFORDAMPicker\").removeAll();"
                ],
                "name": "beforeclose",
                "scope": "me"
            },
            "designerId": "32a02590-abaf-438e-a255-dbd261bf0cf6"
        },
        {
            "type": "Ext.toolbar.Paging",
            "reference": {
                "name": "dockedItems",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "dock": "bottom",
                "width": 360,
                "displayInfo": true,
                "store": "DAMPickerStore"
            },
            "designerId": "82616952-af27-4097-a217-c945fd01b259",
            "cn": [
                {
                    "type": "Ext.button.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "localiserId": "chooseBtn",
                        "layout|flex": null,
                        "disabled": true,
                        "id": "imagePickerAcceptBtn",
                        "iconCls": "ouiSpetit",
                        "text": "Choisir"
                    },
                    "designerId": "b5f0469a-4889-4227-a446-e1319ad527b5",
                    "customConfigs": [
                        {
                            "group": "(Custom Properties)",
                            "name": "localiserId",
                            "type": "string"
                        }
                    ],
                    "cn": [
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onImagePickerAcceptBtnClick",
                                "implHandler": [
                                    "var target = button.up().up().getComponent(0).getSelectionModel().getLastSelected();\r",
                                    "Ext.getCmp(button.up().up().targetField).setValue(target.get(\"id\"));\r",
                                    "button.up().up().close();"
                                ],
                                "name": "click",
                                "scope": "me"
                            },
                            "designerId": "2acb7d2d-c1a9-4fdd-a6b2-5dd3f618f6b4"
                        }
                    ]
                },
                {
                    "type": "Ext.button.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "localiserId": "addBtn",
                        "layout|flex": null,
                        "id": "DAMPickerAddBtn",
                        "iconCls": "add",
                        "text": "Ajouter"
                    },
                    "designerId": "38b4192f-6d63-460e-9114-816838ddef57",
                    "customConfigs": [
                        {
                            "group": "(Custom Properties)",
                            "name": "localiserId",
                            "type": "string"
                        }
                    ],
                    "cn": [
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onDAMPickerAddBtnClick",
                                "implHandler": [
                                    "if ((!Ext.isEmpty(Ext.getCmp('chooseMTInPickerCombo')))&&(!Ext.isEmpty(Ext.getCmp('chooseMTInPickerCombo').getValue()))) {\r",
                                    "    var DAMType=Ext.getStore(\"MediaTypesFORDAMPicker\").findRecord(\"id\", Ext.getCmp('chooseMTInPickerCombo').getValue());\r",
                                    "    var myEditor = Ext.widget(\"DAMCreateUpdateWindow\");\r",
                                    "    Ext.getCmp(\"DAMMainFileFieldBox\").up().remove(Ext.getCmp(\"DAMMainFileFieldBox\"));\r",
                                    "    myEditor.typeId=DAMType.get(\"id\");\r",
                                    "    myEditor.mainFileType=DAMType.get(\"mainFileType\");\r",
                                    "    myEditor.setTitle(Rubedo.RubedoAutomatedElementsLoc.newDamText+\" \"+DAMType.get(\"type\"));\r",
                                    "    myEditor.directContribute=true;\r",
                                    "    myEditor.show();\r",
                                    "    Rubedo.controller.DAMController.prototype.renderDAMTypeFields(DAMType, false);\r",
                                    "    Rubedo.controller.DAMController.prototype.renderTaxoFields(DAMType,true);\r",
                                    "    Ext.getCmp(\"DAMCreateUpdateWindow\").doLayout();\r",
                                    "} else if (!Ext.isEmpty(Ext.getStore(\"MediaTypesFORDAMPicker\").getRange())){\r",
                                    "    Ext.widget(\"DAMChooseMTWindow\").show();\r",
                                    "    Ext.getCmp(\"DAMChooseMTWindow\").getComponent(0).getComponent(0).bindStore(Ext.getStore(\"MediaTypesFORDAMPicker\"));\r",
                                    "    Ext.getCmp(\"addDamAfterTypeBtn\").nonClassic=true;\r",
                                    "    Ext.getCmp(\"addDamAfterTypeBtn\").setHandler(function(){\r",
                                    "        var form=Ext.getCmp(\"addDamAfterTypeBtn\").up();\r",
                                    "        if (form.getForm().isValid()){\r",
                                    "            var DAMType=Ext.getStore(\"MediaTypesFORDAMPicker\").findRecord(\"id\", form.getComponent(0).getValue());\r",
                                    "            var myEditor = Ext.widget(\"DAMCreateUpdateWindow\");\r",
                                    "            Ext.getCmp(\"DAMMainFileFieldBox\").up().remove(Ext.getCmp(\"DAMMainFileFieldBox\"));\r",
                                    "            myEditor.typeId=DAMType.get(\"id\");\r",
                                    "            myEditor.mainFileType=DAMType.get(\"mainFileType\");\r",
                                    "            myEditor.setTitle(Rubedo.RubedoAutomatedElementsLoc.newDamText+\" \"+DAMType.get(\"type\"));\r",
                                    "            myEditor.directContribute=true;\r",
                                    "            myEditor.show();\r",
                                    "            Ext.getCmp(\"addDamAfterTypeBtn\").up().up().close();\r",
                                    "            Rubedo.controller.DAMController.prototype.renderDAMTypeFields(DAMType, false);\r",
                                    "            Rubedo.controller.DAMController.prototype.renderTaxoFields(DAMType,true);\r",
                                    "            Ext.getCmp(\"DAMCreateUpdateWindow\").doLayout();\r",
                                    "        }\r",
                                    "\r",
                                    "    });\r",
                                    "\r",
                                    "\r",
                                    "\r",
                                    "\r",
                                    "} else {\r",
                                    "    Ext.Msg.alert(\"Erreur\", \"Aucun type de média défini\");\r",
                                    "}\r",
                                    ""
                                ],
                                "name": "click",
                                "scope": "me"
                            },
                            "designerId": "04d12175-05f0-49d6-b852-600597648f1c"
                        },
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onDAMPickerAddBtnRender",
                                "implHandler": [
                                    "if (typeof(Rubedo.view.DAMCreateUpdateWindow)==\"undefined\"){\r",
                                    "    component.hide();\r",
                                    "}"
                                ],
                                "name": "render",
                                "scope": "me"
                            },
                            "designerId": "9541c829-4bb4-4a0b-b319-0879f292b29a"
                        }
                    ]
                },
                {
                    "type": "Ext.button.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "localiserId": "cancelBtn",
                        "layout|flex": null,
                        "iconCls": "close",
                        "text": "Annuler"
                    },
                    "designerId": "81c29517-6564-4a65-8100-ebff5447b45a",
                    "customConfigs": [
                        {
                            "group": "(Custom Properties)",
                            "name": "localiserId",
                            "type": "string"
                        }
                    ],
                    "cn": [
                        {
                            "type": "fixedfunction",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "handler",
                                "designer|params": [
                                    "button",
                                    "event"
                                ],
                                "implHandler": [
                                    "this.up().up().close();"
                                ]
                            },
                            "designerId": "81bf382b-7076-4a7a-a8bb-bc557dbb9746"
                        }
                    ]
                }
            ]
        },
        {
            "type": "linkedinstance",
            "reference": {
                "name": "tools",
                "type": "array"
            },
            "codeClass": null,
            "designerId": "05561d8c-f690-4953-8383-9b280c060bda",
            "masterInstanceId": "1ab0b0a2-44a7-48b2-8bf5-cfcf4aa29237"
        }
    ]
}