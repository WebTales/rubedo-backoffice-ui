{
    "type": "Ext.panel.Panel",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "container|align": "stretch",
        "id": "productSettingsForm",
        "designer|userClassName": "productSettingsForm",
        "designer|userAlias": "productSettingsForm",
        "layout": "vbox",
        "bodyPadding": null,
        "title": "Product settings"
    },
    "designerId": "2ae78d7f-914e-476c-840e-3b4423f7e7ae",
    "cn": [
        {
            "type": "Ext.form.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "bodyPadding": 10,
                "title": ""
            },
            "designerId": "a6e711fc-b66c-4a95-9973-9936e6c7ba1f",
            "cn": [
                {
                    "type": "Ext.form.field.Text",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "layout|anchor": "100%",
                        "fieldLabel": "SKU",
                        "name": "sku",
                        "allowBlank": false,
                        "allowOnlyWhitespace": false
                    },
                    "designerId": "a52f0f59-5772-4fc9-a469-99c03a056824"
                },
                {
                    "type": "Ext.form.field.Number",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "layout|anchor": "100%",
                        "id": "basePriceField",
                        "fieldLabel": "Base price",
                        "name": "basePrice",
                        "allowBlank": false,
                        "minValue": 0
                    },
                    "designerId": "e1aa9ae9-7bb0-4474-bdd1-53d7758eabc4"
                }
            ]
        },
        {
            "type": "Ext.grid.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "layout|flex": 1,
                "height": null,
                "id": "productVariationsGrid",
                "title": "Variations"
            },
            "designerId": "719cd507-c957-4f9f-b349-340060534ac4",
            "cn": [
                {
                    "type": "Ext.grid.column.Column",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "string",
                        "text": "String"
                    },
                    "designerId": "be500d0e-1bed-43df-8bbd-ea586d723e83"
                },
                {
                    "type": "Ext.grid.column.Number",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "number",
                        "text": "Number"
                    },
                    "designerId": "0121ed14-dc66-4921-8153-398dcaabfd2c"
                },
                {
                    "type": "Ext.grid.column.Date",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "date",
                        "text": "Date"
                    },
                    "designerId": "ad14d709-a397-43e9-8db5-32870cbedc4f"
                },
                {
                    "type": "Ext.grid.column.Boolean",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "bool",
                        "text": "Boolean"
                    },
                    "designerId": "ffdb18eb-45e3-4f91-860e-dbd5de3b690c"
                },
                {
                    "type": "Ext.grid.View",
                    "reference": {
                        "name": "viewConfig",
                        "type": "object"
                    },
                    "codeClass": null,
                    "designerId": "c9823752-9ea5-4773-9750-2e63fe86a668",
                    "cn": [
                        {
                            "type": "Ext.grid.plugin.DragDrop",
                            "reference": {
                                "name": "plugins",
                                "type": "array"
                            },
                            "codeClass": "Ext.grid.plugin.DragDrop",
                            "designerId": "e8027769-fcec-467b-a766-cd8ba063776c"
                        }
                    ]
                },
                {
                    "type": "Ext.toolbar.Toolbar",
                    "reference": {
                        "name": "dockedItems",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dock": "top"
                    },
                    "designerId": "028e5349-cfa7-4653-8284-c254e9cc896b",
                    "cn": [
                        {
                            "type": "Ext.toolbar.Fill",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "layout|flex": null
                            },
                            "designerId": "21bb0c65-cc27-44c3-8676-c6da54be84bb"
                        },
                        {
                            "type": "Ext.button.Button",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "layout|flex": null,
                                "iconCls": "add",
                                "text": "Add"
                            },
                            "designerId": "a61c3f71-704f-4a15-93f2-a4c910757612",
                            "cn": [
                                {
                                    "type": "basiceventbinding",
                                    "reference": {
                                        "name": "listeners",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "fn": "onButtonClick",
                                        "implHandler": [
                                            "var form=button.up().up().up().getComponent(0).getForm();\r",
                                            "if (form.isValid()){\r",
                                            "    Ext.Ajax.request({\r",
                                            "    url: 'xhr-get-mongo-id',\r",
                                            "    params: { },\r",
                                            "    success: function(response){\r",
                                            "        var servedId = Ext.JSON.decode(response.responseText).mongoID;\r",
                                            "        button.up().up().getStore().add({price:form.getValues().basePrice,sku:form.getValues().sku,stock:0, id:servedId});\r",
                                            "    },\r",
                                            "    failure: function(){\r",
                                            "        Ext.Msg.alert(Rubedo.RubedoAutomatedElementsLoc.errorTitle, \"Failed to retrieve ID\");\r",
                                            "\r",
                                            "    }\r",
                                            "    });\r",
                                            "} else {\r",
                                            "    Ext.Msg.alert(\"Error\",\"SKU and Base price are required in order to create variations\");\r",
                                            "}\r",
                                            ""
                                        ],
                                        "name": "click",
                                        "scope": "me"
                                    },
                                    "designerId": "a428a486-0e27-437b-a410-9d5ca17052a9"
                                }
                            ]
                        },
                        {
                            "type": "Ext.button.Button",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "layout|flex": null,
                                "disabled": true,
                                "id": "variationRemoverBtn",
                                "iconCls": "close",
                                "text": "Remove"
                            },
                            "designerId": "d7e3c802-65b7-4c19-8e1e-9f44d9e717e0",
                            "cn": [
                                {
                                    "type": "basiceventbinding",
                                    "reference": {
                                        "name": "listeners",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "fn": "onVariationRemoverBtnClick",
                                        "implHandler": [
                                            "button.up().up().getStore().remove(button.up().up().getSelectionModel().getLastSelected());"
                                        ],
                                        "name": "click",
                                        "scope": "me"
                                    },
                                    "designerId": "321b78ca-09eb-415d-961c-d6ef7a508b23"
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "basiceventbinding",
                    "reference": {
                        "name": "listeners",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "fn": "onProductVariationsGridSelectionChange",
                        "implHandler": [
                            "if (Ext.isEmpty(selected)){\r",
                            "    Ext.getCmp(\"variationRemoverBtn\").disable();\r",
                            "} else {\r",
                            "    Ext.getCmp(\"variationRemoverBtn\").enable();\r",
                            "}"
                        ],
                        "name": "selectionchange",
                        "scope": "me"
                    },
                    "designerId": "ff571074-469b-4610-a8fb-78310e09236c"
                },
                {
                    "type": "Ext.grid.plugin.CellEditing",
                    "reference": {
                        "name": "plugins",
                        "type": "array"
                    },
                    "codeClass": "Ext.grid.plugin.CellEditing",
                    "userConfig": {
                        "clicksToEdit": 1
                    },
                    "designerId": "75a07cee-4842-47f7-a9dc-b64b332be990"
                }
            ]
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "isValid",
                "implHandler": [
                    "if (!Ext.getCmp(\"productSettingsForm\").getComponent(0).getForm().isValid()){\r",
                    "    Ext.Msg.alert(Rubedo.RubedoAutomatedElementsLoc.errorTitle,\"Invalid product settings\");\r",
                    "    return false;\r",
                    "}\r",
                    "if (Ext.isEmpty(Ext.getCmp(\"productSettingsForm\").getComponent(1).getStore().getRange())){\r",
                    "    Ext.Msg.alert(Rubedo.RubedoAutomatedElementsLoc.errorTitle,\"Product must have at least one variation\");\r",
                    "    return false;\r",
                    "}\r",
                    "var dataOk=true;\r",
                    "Ext.Array.forEach(Ext.Array.pluck(Ext.getCmp(\"productSettingsForm\").getComponent(1).getStore().getRange(),\"data\"),function(variation){\r",
                    "    Ext.Object.each(variation, function(key, value, myself) {\r",
                    "        if (Ext.isEmpty(value)){\r",
                    "            dataOk=false;\r",
                    "        }\r",
                    "    });\r",
                    "});\r",
                    "if (!dataOk){\r",
                    "    Ext.Msg.alert(Rubedo.RubedoAutomatedElementsLoc.errorTitle,\"Invalid variation settings. Each variation must have a valid value for each column\");\r",
                    "}\r",
                    "return dataOk;"
                ]
            },
            "designerId": "98fcada9-5672-4e71-a6a3-40f287c89a3d"
        }
    ]
}