{
    "type": "controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "FormsController",
        "designer|userAlias": "FormsController"
    },
    "id": "ExtBox1-ext-gen6522",
    "designerId": "82778ea5-36d1-422d-993a-6b91ab641629",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onAddFormBtnClick",
                "fn": "onAddFormBtnClick",
                "implHandler": [
                    "Ext.widget(\"newFormWindow\").show();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#addFormBtn"
            },
            "designerId": "f52e88d9-2add-4a07-acc1-929ddb435d17"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onSubmitNewFormBtnClick",
                "fn": "onSubmitNewFormBtnClick",
                "implHandler": [
                    "var me=this;\r",
                    "var form=button.up().getForm();\r",
                    "if (form.isValid()){\r",
                    "    var newOne=Ext.create(\"Rubedo.model.formModel\",form.getValues());\r",
                    "    newOne.set(\"workspaces\",[ACL.defaultWorkspace]);\r",
                    "    Ext.getStore(\"FormsStore\").add(newOne);\r",
                    "    Ext.getStore(\"FormsStore\").addListener(\"datachanged\", function(){\r",
                    "        Ext.getCmp(\"mainFormsGrid\").getSelectionModel().select([newOne]);\r",
                    "    },this,{single:true});\r",
                    "        button.up().up().close();\r",
                    "    }"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#submitNewFormBtn"
            },
            "designerId": "ad68df93-1a56-466f-a58b-b0ec27d774a3"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "resetInterfaceSelect",
                "fn": "resetInterfaceSelect",
                "designer|params": [
                    "record"
                ],
                "implHandler": [
                    "Ext.getCmp(\"formPropsForm\").getForm().setValues(record.getData());\r",
                    "Ext.getCmp(\"formRightsForm\").getForm().setValues(record.getData());\r",
                    "Ext.getCmp(\"FormsCenterZone\").enable();\r",
                    "Ext.Array.forEach(Ext.getCmp(\"FormsInterface\").getDockedComponent(\"contextBar\").query(\"buttongroup\"), function(thing){thing.enable();});\r",
                    "Ext.getCmp(\"removeFormBtn\").enable();\r",
                    "Ext.getCmp(\"FormsInterface\").getComponent(\"breadcrumb\").removeAll();\r",
                    "Ext.getCmp(\"FormsInterface\").getComponent(\"breadcrumb\").add(Ext.widget(\"button\", {text: \"Formulaires <b> > </b>\", iconCls:\"form_small\"}));\r",
                    "Ext.getCmp(\"FormsInterface\").getComponent(\"breadcrumb\").add(Ext.widget(\"button\", {text: record.get(\"title\"), iconCls:\"form_small\"}));\r",
                    "var metaBox = Ext.getCmp(\"FormsInterface\").getDockedComponent('barreMeta').getComponent('boiteBarreMeta');\r",
                    "var values= record.getData();\r",
                    "values.creation= Ext.Date.format(values.createTime, 'd-m-Y');\r",
                    "values.derniereModification= Ext.Date.format(values.lastUpdateTime, 'd-m-Y');\r",
                    "metaBox.update(values);\r",
                    "metaBox.show();\r",
                    "Ext.getCmp(\"formSelectedElementField\").setValue(null);"
                ]
            },
            "designerId": "b24e3b9b-de2d-416d-b923-d047ea4b8202"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "resetInterfaceNoSelect",
                "fn": "resetInterfaceNoSelect",
                "implHandler": [
                    "Ext.getCmp(\"formPropsForm\").getForm().reset();\r",
                    "Ext.getCmp(\"formRightsForm\").getForm().reset();\r",
                    "Ext.getCmp(\"FormsCenterZone\").getLayout().setActiveItem(0);\r",
                    "Ext.getCmp(\"FormsCenterZone\").disable();\r",
                    "Ext.Array.forEach(Ext.getCmp(\"FormsInterface\").getDockedComponent(\"contextBar\").query(\"buttongroup\"), function(thing){thing.disable();});\r",
                    "Ext.getCmp(\"removeFormBtn\").disable();\r",
                    "Ext.getCmp(\"FormsInterface\").getDockedComponent(\"barreMeta\").getComponent(\"boiteBarreMeta\").hide();\r",
                    "Ext.getCmp(\"FormsInterface\").getComponent(\"breadcrumb\").removeAll();\r",
                    "Ext.getCmp(\"FormsInterface\").getComponent(\"breadcrumb\").add(Ext.widget(\"button\", {text: \"Formulaires\", iconCls:\"form_small\"}));\r",
                    "Ext.getCmp(\"formSelectedElementField\").setValue(null);"
                ]
            },
            "designerId": "67493c81-5c85-4775-a117-e1caf6222371"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onRemoveFormBtnClick",
                "fn": "onRemoveFormBtnClick",
                "implHandler": [
                    "var target = Ext.getCmp('mainFormsGrid').getSelectionModel().getLastSelected();\r",
                    "var me=this;\r",
                    "if (!Ext.isEmpty(target)) {\r",
                    "    var window = Ext.widget('delConfirmZ');\r",
                    "    Ext.getCmp('ViewportPrimaire').add(window);\r",
                    "    window.show();\r",
                    "    Ext.getCmp('delConfirmZOui').on('click', function() { \r",
                    "        Ext.getStore(\"FormsStore\").remove(target);            \r",
                    "        Ext.getCmp('delConfirmZ').close();  \r",
                    "        me.resetInterfaceNoSelect();\r",
                    "    });  \r",
                    "\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#removeFormBtn"
            },
            "designerId": "cc253274-c5e7-43ef-b47a-b6a7d04ea6f4"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onMainFormsGridSelectionChange",
                "fn": "onMainFormsGridSelectionChange",
                "implHandler": [
                    "var me=this;\r",
                    "if (Ext.isEmpty(selections)){\r",
                    "    me.resetInterfaceNoSelect();\r",
                    "} else {\r",
                    "    me.resetInterfaceSelect(selections[0]);\r",
                    "}"
                ],
                "name": "selectionchange",
                "scope": "me",
                "designer|targetType": "Ext.grid.Panel",
                "designer|controlQuery": "#mainFormsGrid"
            },
            "designerId": "7cb522f6-be96-4f4f-8a67-cd5d5f9a4c94"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onFormSaveBtnClick",
                "fn": "onFormSaveBtnClick",
                "implHandler": [
                    "var me=this;\r",
                    "if (Ext.getCmp(\"formRightsForm\").getForm().isValid()){\r",
                    "    if (Ext.getCmp(\"formPropsForm\").getForm().isValid()){\r",
                    "        var target = Ext.getCmp('mainFormsGrid').getSelectionModel().getLastSelected();\r",
                    "        target.beginEdit();\r",
                    "        target.set(Ext.getCmp(\"formRightsForm\").getForm().getValues());\r",
                    "        target.set(Ext.getCmp(\"formPropsForm\").getForm().getValues());\r",
                    "        target.endEdit();\r",
                    "        Ext.getStore(\"FormsStore\").addListener(\"datachanged\", function(){\r",
                    "            me.resetInterfaceSelect(target);\r",
                    "        },this,{single:true});\r",
                    "        } else {\r",
                    "            Ext.Msg.alert(\"Erreur\", \"Propriétés du formulaire invalides\");\r",
                    "            Ext.getCmp(\"FormsCenterZone\").getLayout().setActiveItem(0);\r",
                    "        }\r",
                    "    } else {\r",
                    "        Ext.Msg.alert(\"Erreur\", \"Paramétrage des droits invalide\");\r",
                    "        Ext.getCmp(\"FormsCenterZone\").getLayout().setActiveItem(2);\r",
                    "    }"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#formSaveBtn"
            },
            "designerId": "d793d0db-2a9d-4691-814f-39f86b9c5bbc"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "selectionEvents",
                "fn": "selectionEvents",
                "implHandler": [
                    "abstractcomponent.getEl().on(\"click\", function(e){\r",
                    "    Ext.getCmp(\"formSelectedElementField\").setValue(abstractcomponent.getId());\r",
                    "    e.stopEvent();\r",
                    "});\r",
                    "\r",
                    ""
                ],
                "name": "render",
                "scope": "me",
                "designer|targetType": "Ext.panel.Panel",
                "designer|controlQuery": "#FormsEditor panel"
            },
            "designerId": "b1146b2c-be11-4d06-90e4-1ac36ff789d2"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onFormSelectedElementFieldChange",
                "fn": "onFormSelectedElementFieldChange",
                "implHandler": [
                    "var previousOne = Ext.getCmp(oldValue);\r",
                    "if (!Ext.isEmpty(previousOne)){\r",
                    "    previousOne.removeBodyCls(\"selectedelement\");\r",
                    "}\r",
                    "Ext.Array.forEach(Ext.getCmp(\"formElementsEditBtnGroup\").query(\"button\"),function(thing){thing.disable();});\r",
                    "var newOne=Ext.getCmp(newValue);\r",
                    "if (!Ext.isEmpty(newOne)){\r",
                    "    newOne.addBodyCls(\"selectedelement\");\r",
                    "    newOne.getEl().frame(MyPrefData.themeColor);\r",
                    "    if (newValue==\"FormsEditContainer\"){\r",
                    "        Ext.getCmp(\"formAddPageBtn\").enable();\r",
                    "    }\r",
                    "}"
                ],
                "name": "change",
                "scope": "me",
                "designer|targetType": "Ext.form.field.Hidden",
                "designer|controlQuery": "#formSelectedElementField"
            },
            "designerId": "42029d5f-bf11-4f67-b9e4-30a48e0a4127"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onFormElementAddBtnClick",
                "fn": "onFormElementAddBtnClick",
                "implHandler": [
                    "Ext.widget(\"addFormFieldWindow\").show();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#formElementAddBtn"
            },
            "designerId": "4e0344d3-01b9-4147-abf4-3ce2af7ef113"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onFormAddPageBtnClick",
                "fn": "onFormAddPageBtnClick",
                "implHandler": [
                    "Ext.Ajax.request({\r",
                    "    url: 'xhr-get-mongo-id',\r",
                    "    params: { },\r",
                    "    success: function(response){\r",
                    "        var servedId = Ext.JSON.decode(response.responseText).mongoID;\r",
                    "        var target=Ext.getCmp(Ext.getCmp('formSelectedElementField').getValue());\r",
                    "        var newPage = Ext.widget(\"RFormPage\", {id:servedId});\r",
                    "        newPage.itemConfig={\r",
                    "            id:servedId,\r",
                    "            label:\"Page\",\r",
                    "            type:\"page\"\r",
                    "        };\r",
                    "        target.add(newPage);    \r",
                    "        newPage.getEl().dom.click();\r",
                    "    },\r",
                    "    failure: function(){\r",
                    "        Ext.Msg.alert('Erreur', 'Erreur dans la récupération d\\'un identifiant.');\r",
                    "\r",
                    "    }\r",
                    "});\r",
                    "\r",
                    ""
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#formAddPageBtn"
            },
            "designerId": "b38b8241-db47-4795-af43-54cdd78dbdfd"
        }
    ]
}