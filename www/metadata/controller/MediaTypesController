{
    "type": "controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "MediaTypesController",
        "designer|userAlias": "MediaTypesController"
    },
    "id": "ExtBox1-ext-gen33499",
    "designerId": "2a85a03b-de9d-4abc-80a4-82114d4267cf",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onNewMTBtnClick",
                "fn": "onNewMTBtnClick",
                "implHandler": [
                    "Ext.widget(\"newMTWindow\").show();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#newMTBtn"
            },
            "designerId": "8e5babb4-2faa-4faf-a51f-9b4c3d7849d8"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onCreateNewMTBtnClick",
                "fn": "onCreateNewMTBtnClick",
                "implHandler": [
                    "if (button.up().getForm().isValid()) {\r",
                    "    var newMT=Ext.create(\"Rubedo.model.mediaTypeModel\",button.up().getForm().getValues());\r",
                    "    newMT.set(\"vocabularies\", [ ]);\r",
                    "    newMT.set(\"fields\", [ ]);\r",
                    "    Ext.getStore(\"MediaTypes\").add(newMT);\r",
                    "    button.up().up().close();\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#createNewMTBtn"
            },
            "designerId": "c2ea7078-1d68-4214-84af-6a2dfcb589ca"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "resetInterfaceNoSelect",
                "fn": "resetInterfaceNoSelect",
                "implHandler": [
                    "Ext.Array.forEach(Ext.getCmp(\"mediaTypesInterface\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btng){btng.disable();});\r",
                    "Ext.getCmp(\"removeMTBtn\").disable();\r",
                    "Ext.getCmp(\"mediaTypesInterface\").getComponent(\"breadcrumb\").removeAll();\r",
                    "Ext.getCmp(\"mediaTypesInterface\").getComponent(\"breadcrumb\").add(Ext.widget(\"button\", {text: \"Types de médias\", iconCls:\"mediaTypes\"}));\r",
                    "Ext.getCmp('MTeditFields').removeAll();\r",
                    "Ext.getCmp(\"MTcenterZone\").disable();"
                ]
            },
            "designerId": "22525587-131f-47d2-adad-c4b415572d62"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "resetInterfaceSelect",
                "fn": "resetInterfaceSelect",
                "designer|params": [
                    "record"
                ],
                "implHandler": [
                    "var me =this;\r",
                    "Ext.Array.forEach(Ext.getCmp(\"mediaTypesInterface\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btng){btng.enable();});\r",
                    "Ext.getCmp(\"removeMTBtn\").enable();\r",
                    "Ext.getCmp(\"mediaTypesInterface\").getComponent(\"breadcrumb\").removeAll();\r",
                    "Ext.getCmp(\"mediaTypesInterface\").getComponent(\"breadcrumb\").add(Ext.widget(\"button\", {text: \"Types de médias <b> > </b>\", iconCls:\"mediaTypes\"}));\r",
                    "Ext.getCmp(\"mediaTypesInterface\").getComponent(\"breadcrumb\").add(Ext.widget(\"button\", {text: record.get(\"type\"), iconCls:\"mediaTypes\"}));\r",
                    "Ext.getCmp(\"MTcenterZone\").enable();\r",
                    "var selector= [];\r",
                    "Ext.Array.forEach(record.get(\"vocabularies\"),function(vocabId){\r",
                    "    selector.push(Ext.getCmp(\"vocabulariesMTGrid\").getStore().findRecord(\"id\", vocabId));\r",
                    "});\r",
                    "Ext.getCmp(\"vocabulariesMTGrid\").getSelectionModel().select(selector);\r",
                    "var targetZone=Ext.getCmp('MTeditFields');\r",
                    "targetZone.removeAll();\r",
                    "Ext.Array.forEach(record.get(\"fields\"),function(field){\r",
                    "    me.renderMTField(field, targetZone);\r",
                    "});"
                ]
            },
            "designerId": "ee596e99-3cba-4350-b50b-6a028307d35a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onMainMTGridSelect",
                "fn": "onMainMTGridSelect",
                "implHandler": [
                    "this.resetInterfaceSelect(record);"
                ],
                "name": "select",
                "scope": "me",
                "designer|targetType": "Ext.grid.Panel",
                "designer|controlQuery": "#mainMTGrid"
            },
            "designerId": "d77217b6-a7a4-4f45-9993-a859e9d721a8"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onRemoveMTBtnClick",
                "fn": "onRemoveMTBtnClick",
                "implHandler": [
                    "var me=this;\r",
                    "var target = Ext.getCmp('mainMTGrid').getSelectionModel().getSelection()[0];\r",
                    "if (Ext.isDefined(target)) {\r",
                    "    var delCon = Ext.widget('delConfirmZ');\r",
                    "    delCon.show();\r",
                    "    Ext.getCmp('delConfirmZOui').on('click', function() { \r",
                    "        Ext.getCmp('mainMTGrid').getStore().remove(target);\r",
                    "        Ext.getCmp('delConfirmZ').close();\r",
                    "        me.resetInterfaceNoSelect();\r",
                    "\r",
                    "    });  \r",
                    "\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#removeMTBtn"
            },
            "designerId": "b44db20e-1956-4783-9446-c9967f5f33a9"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "updateMT",
                "fn": "updateMT",
                "designer|params": [
                    "record"
                ],
                "implHandler": [
                    "var me=this;\r",
                    "record.beginEdit();\r",
                    "var newVocabularies=Ext.Array.pluck(Ext.Array.pluck(Ext.getCmp(\"vocabulariesMTGrid\").getSelectionModel().getSelection(), \"data\"), \"id\");\r",
                    "record.set(\"vocabularies\", newVocabularies);\r",
                    "record.set(\"fields\", me.recordFields(Ext.getCmp('MTeditFields')));\r",
                    "record.endEdit();"
                ]
            },
            "designerId": "1170ac62-74f1-47f2-858d-bb865b9c5a83"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onSaveMTBtnClick",
                "fn": "onSaveMTBtnClick",
                "implHandler": [
                    "this.updateMT(Ext.getCmp(\"mainMTGrid\").getSelectionModel().getLastSelected());"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#saveMTBtn"
            },
            "designerId": "465a0fde-261b-4daa-a451-461beaa7941e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onNewMTFieldBtnClick",
                "fn": "onNewMTFieldBtnClick",
                "implHandler": [
                    "Ext.widget(\"MTFieldAddWindow\").show();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#newMTFieldBtn"
            },
            "designerId": "cfb4f6da-26ac-48b7-8c2b-61b9675b398b"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "renderMTField",
                "fn": "renderMTField",
                "designer|params": [
                    "protoData",
                    "renderTarget"
                ],
                "implHandler": [
                    "var me=this;\r",
                    "var newField= Ext.create(protoData.cType, protoData.config);\r",
                    "newField.config=protoData.config;\r",
                    "newField.protoId=protoData.protoId;\r",
                    "newField.cType=protoData.cType;\r",
                    "newField.anchor = '90%';\r",
                    "newField.style = '{float:left;}';\r",
                    "var casing =Ext.widget('ChampTC');\r",
                    "casing.add(newField);\r",
                    "casing.getComponent('helpBouton').setTooltip(newField.config.tooltip);\r",
                    "if (Ext.isEmpty(newField.config.tooltip)){\r",
                    "    casing.getComponent('helpBouton').hidden=true;\r",
                    "} \r",
                    "if (!me.nameAvailable(newField.name)) {\r",
                    "    var duplic = 1;\r",
                    "    while (!me.nameAvailable(newField.name+duplic)){\r",
                    "        duplic++;\r",
                    "    }\r",
                    "    newField.name=newField.name+duplic;\r",
                    "    newField.config.name=newField.config.name+duplic;\r",
                    "\r",
                    "}\r",
                    "renderTarget.add(casing);"
                ]
            },
            "designerId": "547a1bc7-fd3d-412f-aa2a-b78c6b945034"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "nameAvailable",
                "fn": "nameAvailable",
                "designer|params": [
                    "name"
                ],
                "implHandler": [
                    "var usedNames=[];\r",
                    "Ext.Array.forEach(Ext.getCmp('MTeditFields').query(\"field\"), function(field){\r",
                    "    Ext.Array.include(usedNames,field.name);\r",
                    "});\r",
                    "if (Ext.Array.contains(usedNames,name)){\r",
                    "    return(false);\r",
                    "} else {\r",
                    "    return(true);\r",
                    "}"
                ]
            },
            "designerId": "50521139-945b-40a3-864c-341e337addf3"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onMTFieldInsertBtnClick",
                "fn": "onMTFieldInsertBtnClick",
                "implHandler": [
                    "var proto=Ext.clone(Ext.getCmp(\"MTFieldSelectGrid\").getSelectionModel().getLastSelected().getData());\r",
                    "proto.protoId=proto.id;\r",
                    "this.renderMTField(proto, Ext.getCmp('MTeditFields'));\r",
                    "button.up().up().close();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#MTFieldInsertBtn"
            },
            "designerId": "f2107c8d-ed5c-47c6-8e79-059e32c1e129"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "recordFields",
                "fn": "recordFields",
                "designer|params": [
                    "target"
                ],
                "implHandler": [
                    "var result = [ ];\r",
                    "Ext.Array.forEach(target.query(\"field\"), function(field){\r",
                    "    result.push({\r",
                    "        cType:field.cType,\r",
                    "        config:field.config,\r",
                    "        protoId:field.protoId\r",
                    "    });\r",
                    "});\r",
                    "return(result);"
                ]
            },
            "designerId": "db2e8d2e-fa18-467d-ba4b-53c64981ee24"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onMTFieldSelectGridItemDblClick",
                "fn": "onMTFieldSelectGridItemDblClick",
                "implHandler": [
                    "this.onMTFieldInsertBtnClick(Ext.getCmp(\"MTFieldInsertBtn\"));"
                ],
                "name": "itemdblclick",
                "scope": "me",
                "designer|targetType": "Ext.grid.Panel",
                "designer|controlQuery": "#MTFieldSelectGrid"
            },
            "designerId": "714350f7-49ac-43ca-baa5-9ac28facd8dd"
        }
    ]
}