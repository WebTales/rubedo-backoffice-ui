{
    "type": "controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "UsersController",
        "designer|userAlias": "UsersController"
    },
    "id": "ExtBox1-ext-gen18283",
    "designerId": "d52b97aa-6ec0-4868-8574-1e35f4b86c88",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "groupSelect",
                "fn": "groupSelect",
                "implHandler": [
                    "var users = [ ];\r",
                    "this.getGroupUsers(record,users);\r",
                    "Ext.getStore(\"UsersGroupStore\").loadData(users);\r",
                    "Ext.Array.forEach(Ext.getCmp(\"adminFUtilisateurs\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btn){btn.enable();});\r",
                    "Ext.getCmp(\"groupDeleteButton\").enable();\r",
                    "var arButtons = [ ];\r",
                    "this.ArianneBuilder(record,arButtons);\r",
                    "Ext.getCmp(\"adminFUtilisateurs\").getComponent(\"filArianne\").removeAll();\r",
                    "Ext.getCmp(\"adminFUtilisateurs\").getComponent(\"filArianne\").add(arButtons.reverse());\r",
                    "if (record.isRoot()){\r",
                    "    var name= \" Racine \";\r",
                    "} else {\r",
                    "    var name = \" \"+record.get(\"name\")+\" : \";\r",
                    "    var userNb = users.length;\r",
                    "    var calif = \"vide\";\r",
                    "    if (userNb==1) {calif=\"utilisateur\";} else if (userNb>1) {calif=\"utilisateurs\";} else if (userNb===0) {userNb= undefined;}\r",
                    "}\r",
                    "Ext.getCmp(\"adminFUtilisateurs\").getComponent(\"barreMeta\").getComponent(\"boiteBarreMeta\").update({\r",
                    "    name:name,\r",
                    "    userNb:userNb,\r",
                    "    calif:calif\r",
                    "});"
                ],
                "name": "select",
                "scope": "me",
                "designer|targetType": "Ext.grid.Panel",
                "designer|controlQuery": "#groupsGrid"
            },
            "designerId": "d5a180c2-cf12-41c6-af7a-aac95a40309e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "removeGroup",
                "fn": "removeGroup",
                "implHandler": [
                    "var target = Ext.getCmp(\"groupsGrid\").getSelectionModel().getLastSelected();\r",
                    "if (!Ext.isEmpty(target)) {\r",
                    "    target.remove();\r",
                    "    Ext.Array.forEach(Ext.getCmp(\"adminFUtilisateurs\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btn){btn.disable();});\r",
                    "    button.disable();\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#groupDeleteButton"
            },
            "designerId": "ba45fde9-05e0-4f40-9bf1-4ba0064daf9f"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "openGroupAddWindow",
                "fn": "openGroupAddWindow",
                "implHandler": [
                    "var window = Ext.widget(\"GroupAddWindow\");\r",
                    "Ext.getCmp('ViewportPrimaire').add(window);\r",
                    "window.show();\r",
                    ""
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#groupAddButton"
            },
            "designerId": "f61e9a39-0a51-41ea-b239-15f38bc28d33"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "createGroup",
                "fn": "createGroup",
                "implHandler": [
                    "var target = Ext.getCmp(\"groupsGrid\").getSelectionModel().getLastSelected();\r",
                    "if (Ext.isEmpty(target)) {\r",
                    "    target=Ext.getCmp(\"groupsGrid\").getStore().getRootNode();\r",
                    "}\r",
                    "var nameField = button.previousSibling();\r",
                    "if (nameField.isValid()) {\r",
                    "    target.appendChild({\r",
                    "        name:nameField.getValue(),\r",
                    "        members: [ ],\r",
                    "        rights: { }\r",
                    "    });\r",
                    "    target.expand();\r",
                    "}\r",
                    "button.up().up().close();\r",
                    ""
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#groupCreateButton"
            },
            "designerId": "144cc988-420a-4aa3-8a44-870dd5054898"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onWindowBeforeClose",
                "fn": "onWindowBeforeClose",
                "implHandler": [
                    "Ext.getStore(\"UsersAdminDataStore\").removeAll();"
                ],
                "name": "beforeclose",
                "scope": "me",
                "designer|targetType": "Ext.window.Window",
                "designer|controlQuery": "#UserAdminWindow"
            },
            "designerId": "3375b5d3-7c29-4e47-8ec3-7973d618e5b9"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "changeAdminPwdSubmit",
                "fn": "changeAdminPwdSubmit",
                "implHandler": [
                    "var myForm=button.up().getForm();\r",
                    "\r",
                    "    if (myForm.isValid()) {\r",
                    "        if (myForm.getFieldValues().password==myForm.getFieldValues().passwordConfirm){\r",
                    "        myForm.submit({\r",
                    "            url:\"users/change-password\",\r",
                    "            success: function(form, action) {\r",
                    "                button.up().up().close();\r",
                    "                \r",
                    "            },\r",
                    "            failure: function(form, action) {\r",
                    "                switch (action.failureType) {\r",
                    "                    case Ext.form.action.Action.CLIENT_INVALID:\r",
                    "                    Ext.Msg.alert('Erreur', 'Formulaire invalide');\r",
                    "                    break;\r",
                    "                    case Ext.form.action.Action.CONNECT_FAILURE:\r",
                    "                    Ext.Msg.alert('Erreur', 'Erreur Ajax');\r",
                    "                    break;\r",
                    "                    case Ext.form.action.Action.SERVER_INVALID:\r",
                    "                    Ext.Msg.alert('Erreur', action.result.msg);\r",
                    "                }\r",
                    "            }\r",
                    "        }); } else {\r",
                    "            Ext.Msg.alert('Erreur', \"Les mots de passe ne correspondent pas\");\r",
                    "        }\r",
                    "    }"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#AdminPasswordChangeBtn"
            },
            "designerId": "a97d8177-f772-417c-9577-3fbfe56b07af"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "getGroupUsers",
                "fn": "getGroupUsers",
                "designer|params": [
                    "group",
                    "array"
                ],
                "implHandler": [
                    "if (!group.isRoot()){\r",
                    "    var me=this;\r",
                    "    Ext.Array.forEach(group.get(\"members\"), function(membre){\r",
                    "        var someMembre = Ext.getStore(\"UsersDataStore\").findRecord(\"name\", membre);\r",
                    "        if (!Ext.isEmpty(someMembre)){\r",
                    "            Ext.Array.include(array,someMembre);\r",
                    "        }\r",
                    "    });\r",
                    "}\r",
                    ""
                ]
            },
            "designerId": "03bf4d8d-7208-40bc-ae87-ee81d0db4237"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "openUserAddWindow",
                "fn": "openUserAddWindow",
                "implHandler": [
                    "var target = Ext.getCmp(\"groupsGrid\").getSelectionModel().getLastSelected();\r",
                    "if (!Ext.isEmpty(target)) {\r",
                    "    var window = Ext.widget(\"UserAddWindow\");\r",
                    "    Ext.getCmp('ViewportPrimaire').add(window);\r",
                    "    window.show();\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#userAddButton"
            },
            "designerId": "32ce4eb7-43ac-435d-8196-64a8e0e46d81"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "userSelectionAdd",
                "fn": "userSelectionAdd",
                "implHandler": [
                    "var selection = Ext.Array.pluck(Ext.Array.pluck(button.up().up().getComponent(0).getSelectionModel().getSelection(),\"data\"),\"name\");\r",
                    "var record = Ext.getCmp(\"groupsGrid\").getSelectionModel().getLastSelected();\r",
                    "record.set(\"members\", Ext.Array.union(record.get(\"members\"),selection));\r",
                    "Ext.getCmp(\"groupsGrid\").getSelectionModel().deselectAll();\r",
                    "Ext.getCmp(\"groupsGrid\").getSelectionModel().select(record);\r",
                    "button.up().up().close();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#userSelectionAddButton"
            },
            "designerId": "d506ab15-3503-437c-969b-004bf29956fb"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "ArianneBuilder",
                "fn": "ArianneBuilder",
                "designer|params": [
                    "node",
                    "array"
                ],
                "implHandler": [
                    "var me=this;\r",
                    "if (node.isRoot()) {\r",
                    "    var button = Ext.widget(\"button\", {text:\"Groupes<b> ></b>\", iconCls:\"user\"});\r",
                    "    button.on(\"click\",function(){ Ext.getCmp(\"groupsGrid\").getSelectionModel().select(node);});\r",
                    "    array.push(button);\r",
                    "} else {\r",
                    "    var button = Ext.widget(\"button\", {text:node.get(\"name\")+\"<b> ></b>\", iconCls:\"user\"});\r",
                    "    button.on(\"click\",function(){ Ext.getCmp(\"groupsGrid\").getSelectionModel().select(node);});\r",
                    "    array.push(button);\r",
                    "    me.ArianneBuilder(node.parentNode,array);\r",
                    "}"
                ]
            },
            "designerId": "b3ae164b-36fd-4fc8-a7a5-42b40eb42626"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "removeUserFromGroup",
                "fn": "removeUserFromGroup",
                "implHandler": [
                    "var targets =Ext.Array.pluck(Ext.Array.pluck(Ext.getCmp(\"UsersInGroupGrid\").getSelectionModel().getSelection(),\"data\"),\"name\");\r",
                    "var record=Ext.getCmp(\"groupsGrid\").getSelectionModel().getLastSelected();\r",
                    "record.set(\"members\", Ext.Array.difference(record.get(\"members\"),targets));\r",
                    "Ext.getCmp(\"groupsGrid\").getSelectionModel().deselectAll();\r",
                    "Ext.getCmp(\"groupsGrid\").getSelectionModel().select(record);"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#userRemoveButton"
            },
            "designerId": "26700983-4198-4add-8976-6e2842b7b0e7"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "userAdminSelect",
                "fn": "userAdminSelect",
                "implHandler": [
                    "Ext.getCmp(\"userAdminInfoDisplay\").getForm().loadRecord(record);\r",
                    "Ext.getCmp(\"userAdminAccessDisplay\").getForm().loadRecord(record);\r",
                    "if (Ext.isEmpty(record.get(\"photo\"))) {\r",
                    "    Ext.getCmp(\"userAdminProfilePicture\").setSrc(\"resources/images/userBig.png\");\r",
                    "} else {\r",
                    "    Ext.getCmp(\"userAdminProfilePicture\").setSrc(record.get(\"photo\"));\r",
                    "}"
                ],
                "name": "itemclick",
                "scope": "me",
                "designer|targetType": "Ext.grid.Panel",
                "designer|controlQuery": "#userAdminGrid"
            },
            "designerId": "908d61e5-f2ab-4a31-94d7-c387687d58cc"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "adminInfoUpdate",
                "fn": "adminInfoUpdate",
                "implHandler": [
                    "if (Ext.getCmp(\"userAdminInfoDisplay\").getForm().isValid()) {\r",
                    "    Ext.getCmp(\"userAdminGrid\").getSelectionModel().getLastSelected().set(Ext.getCmp(\"userAdminInfoDisplay\").getForm().getValues());\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#userAdminInfoEdit"
            },
            "designerId": "205c0122-f13f-4d4b-adc9-c7373616bb3a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "newUser",
                "fn": "newUser",
                "implHandler": [
                    "var newUser = Ext.create(\"Rubedo.model.userDataModel\",{\r",
                    "    name:\"Nouvel Utilisateur\",\r",
                    "    creationDate:Ext.Date.now()\r",
                    "});\r",
                    "button.up().up().getComponent(0).getStore().add(newUser);"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#userAdminAdd"
            },
            "designerId": "b016e231-6e64-470a-9d72-9b5056c18eac"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "userRemove",
                "fn": "userRemove",
                "implHandler": [
                    "var targets = button.up().up().getComponent(0).getSelectionModel().getSelection();\r",
                    "button.up().up().getComponent(0).getStore().remove(targets);"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#userAdminRemove"
            },
            "designerId": "17aee2a2-5dba-41fd-b861-1a82d7a8fb72"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onWindowShow",
                "fn": "onWindowShow",
                "implHandler": [
                    "Ext.getStore(\"UsersAdminDataStore\").clearFilter();\r",
                    "Ext.getStore(\"UsersAdminDataStore\").load();"
                ],
                "name": "show",
                "scope": "me",
                "designer|targetType": "Ext.window.Window",
                "designer|controlQuery": "#UserAdminWindow"
            },
            "designerId": "f846cc49-b3e2-43ce-8275-ace5d5099d69"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onMainWindowRender",
                "fn": "onMainWindowRender",
                "implHandler": [
                    "if (abstractcomponent.isXType(\"window\")){\r",
                    "    Ext.getStore(\"UsersDataStore\").clearFilter();\r",
                    "    Ext.getStore(\"UsersDataStore\").load();\r",
                    "}"
                ],
                "name": "render",
                "scope": "me",
                "designer|targetType": "Ext.window.Window",
                "designer|controlQuery": "#adminFUtilisateurs"
            },
            "designerId": "369e4812-8da1-45b1-b858-c405863f003e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onWindowBeforeClose2",
                "fn": "onWindowBeforeClose2",
                "implHandler": [
                    "Ext.getStore(\"UsersDataStore\").removeAll();"
                ],
                "name": "beforeclose",
                "scope": "me",
                "designer|targetType": "Ext.window.Window",
                "designer|controlQuery": "#adminFUtilisateurs"
            },
            "designerId": "32971f1d-2fcc-4fc8-b9ee-947e1e17c79e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onWindowBeforeClose1",
                "fn": "onWindowBeforeClose1",
                "implHandler": [
                    "Ext.getStore(\"UsersDataStore\").clearFilter();"
                ],
                "name": "beforeclose",
                "scope": "me",
                "designer|targetType": "Ext.window.Window",
                "designer|controlQuery": "#UserAddWindow"
            },
            "designerId": "70ef9ae5-0d90-4cac-ae92-b3ea47a49aeb"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "deleteAdminPicture",
                "fn": "deleteAdminPicture",
                "implHandler": [
                    "Ext.getCmp(\"userAdminProfilePicture\").setSrc(\"resources/images/userBig.png\");\r",
                    "Ext.getCmp(\"userAdminGrid\").getSelectionModel().getLastSelected().set(\"photo\", null);"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#userAdminProfilePictureDelete"
            },
            "designerId": "8207d36b-07bf-4ffa-97de-f2afcf5e4a75"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "adminAccessEdit",
                "fn": "adminAccessEdit",
                "implHandler": [
                    "if (Ext.getCmp(\"userAdminAccessDisplay\").getForm().isValid()) {\r",
                    "    Ext.getCmp(\"userAdminGrid\").getSelectionModel().getLastSelected().set(Ext.getCmp(\"userAdminAccessDisplay\").getForm().getValues());\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#userAdminAccessEdit"
            },
            "designerId": "63093309-3444-4fbd-8f56-16fd975913cd"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "openAdminChangePwdWindow",
                "fn": "openAdminChangePwdWindow",
                "implHandler": [
                    "var window = Ext.widget(\"AdminPasswordChange\");\r",
                    "Ext.getCmp('ViewportPrimaire').add(window);\r",
                    "window.show();\r",
                    "window.getComponent(0).getForm().loadRecord(Ext.getCmp(\"userAdminGrid\").getSelectionModel().getLastSelected());"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#AdminChangeUserPwd"
            },
            "designerId": "c35e008c-6517-4379-8842-8a169c91d814"
        }
    ]
}