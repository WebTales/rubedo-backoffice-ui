{
    "type": "controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "ContributionContenusController",
        "models": [
            "contenusDataModel"
        ],
        "stores": [
            "ContenusDataJson"
        ],
        "views": [
            "AjouterContenu"
        ]
    },
    "id": "ExtBox1-ext-gen29010",
    "designerId": "d27eb48c-e6bd-435b-8697-8ff50047fcac",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "typeSelect",
                "fn": "typeSelect",
                "implHandler": [
                    "var filArianne = Ext.getCmp(\"TypesContenusGrid\").findParentByType('window').getDockedComponent('filArianne');\r",
                    "var typeFil = filArianne.getComponent('type');\r",
                    "if (Ext.isDefined(typeFil)) {typeFil.setText(record.data.type);}\r",
                    "else { typeFil= Ext.widget('button',{iconCls: \"folder\", text:record.data.type, itemId:'type'});\r",
                    "filArianne.add(typeFil);\r",
                    "}\r",
                    "\r",
                    "Ext.getCmp(\"ContenusGrid\").filterBar.clearFilters();\r",
                    "\r",
                    "Ext.Array.forEach(Ext.getCmp(\"contributionContenus\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btn){btn.enable();});\r",
                    "Ext.getCmp(\"ajoutPanierContenus\").disable();\r",
                    "Ext.getCmp(\"boutonSupprimerContenu\").disable();\r",
                    "Ext.getCmp(\"boutonModifierContenu\").disable();\r",
                    "Ext.getCmp(\"boutonCopierContenus\").disable();\r",
                    "Ext.getCmp(\"contribWorkflowBox\").disable();\r",
                    "var  customMeta = record.get(\"type\");\r",
                    "var imageMeta = Ext.getCmp('contributionContenus').getDockedComponent('barreMeta').getComponent('imageBarreMeta');\r",
                    "imageMeta.setSrc('resources/icones/'+MyPrefData.iconsDir+'/48x48/folder.png');  \r",
                    "var boiteMeta = Ext.getCmp(\"contributionContenus\").getDockedComponent('barreMeta').getComponent('boiteBarreMeta');\r",
                    "boiteMeta.update(customMeta);"
                ],
                "name": "select",
                "scope": "me",
                "designer|targetType": "Ext.grid.View",
                "designer|controlQuery": "#TypesContenusGrid"
            },
            "designerId": "0466eea6-c776-4c88-b14e-95220a71766a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "contentSaveAndPublish",
                "fn": "contentSaveAndPublish",
                "implHandler": [
                    "this.nContenuRecorder('published',button.isUpdate);"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#boutonPublierNouveauContenu"
            },
            "designerId": "0be12317-77a9-4e12-adae-fbd3e1286d46"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "contentSave",
                "fn": "contentSave",
                "implHandler": [
                    "this.nContenuRecorder('draft', button.isUpdate);"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#boutonEnregistrerNouveauContenu"
            },
            "designerId": "43982057-d428-4c80-892d-67f635c19e58"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "nContenuRecorder",
                "fn": "nContenuRecorder",
                "designer|params": [
                    "status",
                    "update"
                ],
                "implHandler": [
                    "if ((Ext.getCmp(\"boiteAChampsContenus\").getForm().isValid())&&(Ext.getCmp(\"boiteATaxoContenus\").getForm().isValid())&&(Ext.getCmp(\"contentMetadataBox\").getForm().isValid())){\r",
                    "    var champs=Ext.getCmp(\"boiteAChampsContenus\").getForm().getValues();\r",
                    "    var taxonomie =Ext.getCmp(\"boiteATaxoContenus\").getForm().getValues();\r",
                    "    var metaData = Ext.getCmp(\"contentMetadataBox\").getForm().getValues();\r",
                    "    if (update) {\r",
                    "        var myRec =Ext.getCmp(\"ContenusGrid\").getSelectionModel().getSelection()[0];\r",
                    "        myRec.beginEdit();\r",
                    "        myRec.set(\"text\",champs.text);\r",
                    "        myRec.set(\"champs\",champs);\r",
                    "        myRec.set(\"taxonomie\",taxonomie);\r",
                    "        myRec.set(\"status\",status);\r",
                    "        myRec.set(metaData);\r",
                    "        myRec.endEdit();\r",
                    "\r",
                    "    } \r",
                    "    else {\r",
                    "        var nContenu = Ext.create('model.contenusDataModel', {\r",
                    "            text: champs.text,\r",
                    "            champs: champs,\r",
                    "            taxonomie:taxonomie,\r",
                    "            status: status,\r",
                    "            typeId: Ext.getCmp('TypesContenusGridView').getSelectionModel().getLastSelected().get(\"id\")\r",
                    "\r",
                    "        });\r",
                    "        nContenu.set(metaData);\r",
                    "\r",
                    "        Ext.getCmp('ContenusGrid').getStore().add(nContenu);\r",
                    "    }\r",
                    "    Ext.getCmp('ajouterContenu').close();\r",
                    "}"
                ]
            },
            "designerId": "ae3d7d9c-194f-4fdd-b848-335bc618dcb5"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "contentDelete",
                "fn": "contentDelete",
                "implHandler": [
                    "var cible = Ext.getCmp('ContenusGrid').getSelectionModel().getSelection();\r",
                    "this.getContenusDataJsonStore().remove(cible);"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#boutonSupprimerContenu"
            },
            "designerId": "1e8e3da9-d15d-4ff8-ae22-5814e4e23120"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "contentEdit",
                "fn": "contentEdit",
                "implHandler": [
                    "var cible = Ext.getCmp('ContenusGrid').getSelectionModel().getSelection()[0];\r",
                    "Ext.getCmp(\"boutonAjouterContenu\").fireEvent(\"click\");\r",
                    "Ext.getCmp('boiteAChampsContenus').getForm().setValues(cible.get(\"champs\"));\r",
                    "Ext.Object.each(cible.get(\"champs\"), function(key, value, myself){\r",
                    "    if (Ext.isArray(value)) {\r",
                    "        var multiField=Ext.getCmp('boiteAChampsContenus').query('[name='+key+']')[0];\r",
                    "        var y=0;\r",
                    "        if (multiField.multivalued) {\r",
                    "            Ext.Array.each(value,function(val,index){\r",
                    "                if (index>0) {\r",
                    "                    multiField.up().getComponent('boutonReplicateurChamps').fireEvent(\"click\",multiField.up().getComponent('boutonReplicateurChamps'));\r",
                    "                }\r",
                    "                Ext.getCmp('boiteAChampsContenus').query('[name='+key+']')[index].setValue(val);\r",
                    "            }); \r",
                    "        }\r",
                    "    }\r",
                    "});\r",
                    "\r",
                    "Ext.getCmp(\"boiteATaxoContenus\").getForm().setValues(cible.get(\"taxonomie\"));\r",
                    "Ext.getCmp(\"contentMetadataBox\").getForm().loadRecord(cible);\r",
                    "Ext.getCmp(\"boutonEnregistrerNouveauContenu\").isUpdate=true;\r",
                    "Ext.getCmp(\"boutonPublierNouveauContenu\").isUpdate=true;\r",
                    "Ext.getCmp(\"boutonSoumettreNouveauContenu\").isUpdate=true;\r",
                    "Ext.getCmp('ajouterContenu').setTitle(\"Modifier un contenu\");"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#boutonModifierContenu"
            },
            "designerId": "d1d6b138-ff4c-43ec-bf21-9b2632472cf9"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "contentsSelect",
                "fn": "contentsSelect",
                "implHandler": [
                    "var boiteMeta = Ext.getCmp(\"contributionContenus\").getDockedComponent('barreMeta').getComponent('boiteBarreMeta');\r",
                    "var imageMeta = Ext.getCmp('contributionContenus').getDockedComponent('barreMeta').getComponent('imageBarreMeta');\r",
                    "var customMeta= \"\";\r",
                    "if (selections.length===0) {\r",
                    "    Ext.getCmp(\"ajoutPanierContenus\").disable();\r",
                    "    Ext.getCmp(\"boutonSupprimerContenu\").disable();\r",
                    "    Ext.getCmp(\"boutonModifierContenu\").disable();\r",
                    "    Ext.getCmp(\"boutonCopierContenus\").disable();\r",
                    "    Ext.getCmp(\"contribWorkflowBox\").disable();\r",
                    "    customMeta = Ext.getCmp('TypesContenusGrid').getSelectionModel().getLastSelected().data.type;\r",
                    "    imageMeta.setSrc('resources/icones/'+MyPrefData.iconsDir+'/48x48/folder.png');    \r",
                    "\r",
                    "} else if (selections.length==1) {\r",
                    "    Ext.getCmp(\"ajoutPanierContenus\").enable();\r",
                    "    Ext.getCmp(\"boutonSupprimerContenu\").enable();\r",
                    "    Ext.getCmp(\"boutonModifierContenu\").enable();\r",
                    "    Ext.getCmp(\"boutonCopierContenus\").enable();\r",
                    "    Ext.getCmp(\"contribWorkflowBox\").enable();\r",
                    "    Ext.Array.forEach(Ext.getCmp(\"contribWorkflowBox\").items.items, function(item){item.enable();});    \r",
                    "    customMeta=selections[0].get(\"text\")+\"</br> Creation : \"+Ext.Date.format(selections[0].get(\"createTime\"), \"d-m-y\")+\r",
                    "    \" Dernière modification : \"+Ext.Date.format(selections[0].get(\"lastUpdateTime\"), \"d-m-y\")+\" Auteur : \"+selections[0].get(\"createUser\").fullName;\r",
                    "    boiteMeta.update(customMeta);\r",
                    "    if (selections[0].get(\"status\")==\"published\") {\r",
                    "        imageMeta.setSrc('resources/icones/'+MyPrefData.iconsDir+'/48x48/page_accept.png');\r",
                    "        Ext.getCmp(\"contentAcceptPublishBtn\").disable();\r",
                    "        Ext.getCmp(\"contentSubmitValBtn\").disable();\r",
                    "        Ext.getCmp(\"contentRefuseBtn\").disable();\r",
                    "        if (selections[0].get(\"online\")) {\r",
                    "            Ext.getCmp(\"contentOnlineBtn\").disable();\r",
                    "        } else {\r",
                    "            Ext.getCmp(\"contentOfflineBtn\").disable();\r",
                    "        }\r",
                    "    } else if (selections[0].get(\"status\")==\"pending\") {\r",
                    "        imageMeta.setSrc('resources/icones/'+MyPrefData.iconsDir+'/48x48/page_process.png');\r",
                    "        Ext.getCmp(\"contentSubmitValBtn\").disable();\r",
                    "        Ext.getCmp(\"contentOnlineBtn\").disable();\r",
                    "        Ext.getCmp(\"contentOfflineBtn\").disable();\r",
                    "    } else if (selections[0].get(\"status\")==\"draft\") {\r",
                    "        imageMeta.setSrc('resources/icones/'+MyPrefData.iconsDir+'/48x48/page_edit.png');\r",
                    "        Ext.getCmp(\"contentAcceptPublishBtn\").disable();\r",
                    "        Ext.getCmp(\"contentOnlineBtn\").disable();\r",
                    "        Ext.getCmp(\"contentOfflineBtn\").disable();\r",
                    "        Ext.getCmp(\"contentRefuseBtn\").disable();\r",
                    "    } else {\r",
                    "        imageMeta.setSrc('resources/icones/'+MyPrefData.iconsDir+'/48x48/page_full.png');\r",
                    "    }\r",
                    "\r",
                    "\r",
                    "\r",
                    "} else {\r",
                    "    Ext.getCmp(\"ajoutPanierContenus\").enable();\r",
                    "    Ext.getCmp(\"boutonSupprimerContenu\").enable();\r",
                    "    Ext.getCmp(\"boutonModifierContenu\").disable();\r",
                    "    Ext.getCmp(\"boutonCopierContenus\").disable();\r",
                    "    Ext.getCmp(\"contribWorkflowBox\").enable();\r",
                    "    var statuses = [];\r",
                    "    var onlines = [];\r",
                    "    Ext.Array.forEach(selections, function(someContent){\r",
                    "    Ext.Array.include(statuses, someContent.get(\"status\"));\r",
                    "    Ext.Array.include(onlines, someContent.get(\"online\"));\r",
                    "    });\r",
                    "    if (statuses.length>1){\r",
                    "        Ext.getCmp(\"contribWorkflowBox\").disable();\r",
                    "        imageMeta.setSrc('resources/icones/'+MyPrefData.iconsDir+'/48x48/page_full.png');\r",
                    "\r",
                    "    } else {\r",
                    "            Ext.Array.forEach(Ext.getCmp(\"contribWorkflowBox\").items.items, function(item){item.enable();});        \r",
                    "            if (statuses[0]==\"published\") {\r",
                    "            imageMeta.setSrc('resources/icones/'+MyPrefData.iconsDir+'/48x48/page_accept.png');\r",
                    "            Ext.getCmp(\"contentAcceptPublishBtn\").disable();\r",
                    "            Ext.getCmp(\"contentSubmitValBtn\").disable();\r",
                    "            Ext.getCmp(\"contentRefuseBtn\").disable();\r",
                    "            if (onlines.length>1) {\r",
                    "                Ext.getCmp(\"contentOnlineBtn\").disable();\r",
                    "                Ext.getCmp(\"contentOfflineBtn\").disable();\r",
                    "\r",
                    "            }else {\r",
                    "            if (onlines[0]) {\r",
                    "                Ext.getCmp(\"contentOnlineBtn\").disable();\r",
                    "            } else {\r",
                    "                Ext.getCmp(\"contentOfflineBtn\").disable();\r",
                    "            }}\r",
                    "            } else if (statuses[0]==\"pending\") {\r",
                    "                imageMeta.setSrc('resources/icones/'+MyPrefData.iconsDir+'/48x48/page_process.png');\r",
                    "                Ext.getCmp(\"contentSubmitValBtn\").disable();\r",
                    "                Ext.getCmp(\"contentOnlineBtn\").disable();\r",
                    "                Ext.getCmp(\"contentOfflineBtn\").disable();\r",
                    "            } else if (statuses[0]==\"draft\") {\r",
                    "                imageMeta.setSrc('resources/icones/'+MyPrefData.iconsDir+'/48x48/page_edit.png');\r",
                    "                Ext.getCmp(\"contentAcceptPublishBtn\").disable();\r",
                    "                Ext.getCmp(\"contentOnlineBtn\").disable();\r",
                    "                Ext.getCmp(\"contentOfflineBtn\").disable();\r",
                    "                Ext.getCmp(\"contentRefuseBtn\").disable();\r",
                    "            }\r",
                    "    }\r",
                    "    customMeta=selections.length+\" Contenus\";\r",
                    "}\r",
                    "\r",
                    "boiteMeta.update(customMeta);"
                ],
                "name": "selectionchange",
                "scope": "me",
                "designer|targetType": "Ext.grid.Panel",
                "designer|controlQuery": "#ContenusGrid"
            },
            "designerId": "2af287bb-3cc0-46dd-9a77-33d9b9c7235f"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "doubleClickEdit",
                "fn": "doubleClickEdit",
                "implHandler": [
                    "Ext.getCmp(\"boutonModifierContenu\").fireEvent(\"click\");"
                ],
                "name": "itemdblclick",
                "scope": "me",
                "designer|targetType": "Ext.grid.Panel",
                "designer|controlQuery": "#ContenusGrid"
            },
            "designerId": "29809d19-0d43-44be-9789-cb0efb02186f"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "putContentsOnline",
                "fn": "putContentsOnline",
                "implHandler": [
                    "Ext.getStore(\"ContenusDataJson\").suspendAutoSync();\r",
                    "Ext.Array.forEach(Ext.getCmp(\"ContenusGrid\").getSelectionModel().getSelection(), function(content){\r",
                    "    if (content.get(\"status\")==\"published\") {\r",
                    "        content.set(\"online\", true);\r",
                    "    }});\r",
                    "    Ext.getStore(\"ContenusDataJson\").resumeAutoSync();\r",
                    "    Ext.getStore(\"ContenusDataJson\").sync();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#contentOnlineBtn"
            },
            "designerId": "5609cb55-a942-4612-a54f-e9f26e0decce"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "contentRefuse",
                "fn": "contentRefuse",
                "implHandler": [
                    "Ext.getStore(\"ContenusDataJson\").suspendAutoSync();\r",
                    "Ext.Array.forEach(Ext.getCmp(\"ContenusGrid\").getSelectionModel().getSelection(), function(content){\r",
                    "    if (content.get(\"status\")==\"pending\") {\r",
                    "        content.set(\"status\", \"draft\");\r",
                    "    }});\r",
                    "    Ext.getStore(\"ContenusDataJson\").resumeAutoSync();\r",
                    "    Ext.getStore(\"ContenusDataJson\").sync();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#contentRefuseBtn"
            },
            "designerId": "94138a98-a78e-4bb5-ad8b-0e949321e587"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "putContentsOffline",
                "fn": "putContentsOffline",
                "implHandler": [
                    "Ext.getStore(\"ContenusDataJson\").suspendAutoSync();\r",
                    "Ext.Array.forEach(Ext.getCmp(\"ContenusGrid\").getSelectionModel().getSelection(), function(content){\r",
                    "    if (content.get(\"status\")==\"published\") {\r",
                    "        content.set(\"online\", false);\r",
                    "    }});\r",
                    "    Ext.getStore(\"ContenusDataJson\").resumeAutoSync();\r",
                    "    Ext.getStore(\"ContenusDataJson\").sync();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#contentOfflineBtn"
            },
            "designerId": "a09ba59a-d8db-44ca-8e79-c42a6a3dcb2d"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "contentSubmitVal",
                "fn": "contentSubmitVal",
                "implHandler": [
                    "Ext.getStore(\"ContenusDataJson\").suspendAutoSync();\r",
                    "Ext.Array.forEach(Ext.getCmp(\"ContenusGrid\").getSelectionModel().getSelection(), function(content){\r",
                    "    if (content.get(\"status\")==\"draft\") {\r",
                    "        content.set(\"status\", \"pending\");\r",
                    "    }});\r",
                    "    Ext.getStore(\"ContenusDataJson\").resumeAutoSync();\r",
                    "    Ext.getStore(\"ContenusDataJson\").sync();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#contentSubmitValBtn"
            },
            "designerId": "eae53a4e-c7fe-4932-b8c5-bc212c9bb55c"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "contentAcceptPublish",
                "fn": "contentAcceptPublish",
                "implHandler": [
                    "Ext.getStore(\"ContenusDataJson\").suspendAutoSync();\r",
                    "Ext.Array.forEach(Ext.getCmp(\"ContenusGrid\").getSelectionModel().getSelection(), function(content){\r",
                    "    if (content.get(\"status\")==\"pending\") {\r",
                    "        content.set(\"status\", \"published\");\r",
                    "    }});\r",
                    "    Ext.getStore(\"ContenusDataJson\").resumeAutoSync();\r",
                    "    Ext.getStore(\"ContenusDataJson\").sync();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#contentAcceptPublishBtn"
            },
            "designerId": "84f2a9eb-c989-4280-98ec-f1d06b70936e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "contentSaveAndSubmit",
                "fn": "contentSaveAndSubmit",
                "implHandler": [
                    "this.nContenuRecorder('pending',button.isUpdate);"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#boutonSoumettreNouveauContenu"
            },
            "designerId": "b54053e6-c639-4ad5-819e-ed4b31921c1e"
        }
    ]
}