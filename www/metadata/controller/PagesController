{
    "type": "controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "PagesController",
        "designer|userAlias": "PagesController"
    },
    "id": "ExtBox1-ext-gen40229",
    "designerId": "b29235f7-9588-4632-b7ab-b0f2633b21ec",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "pageSiteSelect",
                "fn": "pageSiteSelect",
                "implHandler": [
                    "Ext.getStore(\"PagesDataStore\").getProxy().extraParams.filter=\"[{\\\"property\\\":\\\"site\\\",\\\"value\\\":\\\"\"+records[0].get(\"id\")+\"\\\"}]\";\r",
                    "Ext.getStore(\"PagesDataStore\").load();\r",
                    "Ext.getStore(\"MasksComboStore\").getProxy().extraParams.filter=\"[{\\\"property\\\":\\\"site\\\",\\\"value\\\":\\\"\"+records[0].get(\"id\")+\"\\\"}]\";\r",
                    "Ext.getStore(\"MasksComboStore\").load();\r",
                    "var filArianne = combo.up().up().up().getDockedComponent('filArianne');\r",
                    "var typeFil = filArianne.getComponent('type');\r",
                    "if (Ext.isDefined(typeFil)) {typeFil.setText(records[0].get(\"text\"));}\r",
                    "else { typeFil= Ext.widget('button',{iconCls: \"masque-icon\", text:records[0].get(\"text\"), itemId:'type'});\r",
                    "typeFil.on(\"click\", function(){Ext.getCmp(\"mainPageTree\").getSelectionModel().select(Ext.getCmp(\"mainPageTree\").getRootNode());});\r",
                    "filArianne.add(typeFil);\r",
                    "}\r",
                    "Ext.getCmp(\"addPageBtn\").enable();\r",
                    "Ext.getCmp(\"removePageBtn\").disable();\r",
                    "Ext.Array.forEach(Ext.getCmp(\"contributionPages\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btn){btn.disable();});\r",
                    "Ext.getCmp(\"mainPageEdition\").removeAll();\r",
                    "this.resetInterface();"
                ],
                "name": "select",
                "scope": "me",
                "designer|targetType": "Ext.form.field.ComboBox",
                "designer|controlQuery": "#pagesSitesCombo"
            },
            "designerId": "7f866395-6912-493e-b496-40113840a82e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "openPageAddWindow",
                "fn": "openPageAddWindow",
                "implHandler": [
                    "Ext.widget(\"newPageWindow\").show();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#addPageBtn"
            },
            "designerId": "cb9367d6-8b6d-41dd-a7d1-4a4ad74d5b92"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "createNewPage",
                "fn": "createNewPage",
                "implHandler": [
                    "var form=button.up().getForm();\r",
                    "var target=Ext.getCmp(\"mainPageTree\").getSelectionModel().getLastSelected();\r",
                    "if (Ext.isEmpty(target)) {\r",
                    "    target=Ext.getCmp(\"mainPageTree\").getRootNode();\r",
                    "}\r",
                    "if (form.isValid()){\r",
                    "    var newRows=button.previousSibling().getStore().findRecord(\"id\",button.previousSibling().getValue()).get(\"rows\");\r",
                    "    var newPage=form.getValues();\r",
                    "    newPage.rows=newRows;\r",
                    "    newPage.leaf=true;\r",
                    "    if (!target.hasChildNodes()){\r",
                    "        newPage.orderValue=100;\r",
                    "    } else {\r",
                    "        newPage.orderValue=target.lastChild.get(\"orderValue\")+100;\r",
                    "    }\r",
                    "    newPage.iconCls=\"masque-icon\";\r",
                    "    newPage.site=Ext.getCmp(\"pagesSitesCombo\").getValue();\r",
                    "    var store=Ext.getCmp(\"mainPageTree\").getStore();\r",
                    "    store.suspendAutoSync();\r",
                    "    target.appendChild(newPage);\r",
                    "    target.set(\"leaf\",false);\r",
                    "    target.expand();\r",
                    "    store.resumeAutoSync();\r",
                    "    store.sync();\r",
                    "    button.up().up().close();\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#newPageSubmitBtn"
            },
            "designerId": "58437311-2357-4c3b-99f1-a0fa5762da47"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "deletePage",
                "fn": "deletePage",
                "implHandler": [
                    "var me=this;\r",
                    "var target=Ext.getCmp(\"mainPageTree\").getSelectionModel().getLastSelected();\r",
                    "if (Ext.isDefined(target)) {\r",
                    "    var delCon = Ext.widget('delConfirmZ');\r",
                    "    delCon.show();\r",
                    "    var store=Ext.getCmp(\"mainPageTree\").getStore();\r",
                    "    Ext.getCmp('delConfirmZOui').on('click', function() { \r",
                    "        store.suspendAutoSync();\r",
                    "        var myParent=target.parentNode;\r",
                    "        if ((myParent.childNodes.length==1)&&(!myParent.isRoot())){\r",
                    "            myParent.set(\"leaf\",true);\r",
                    "        }\r",
                    "        target.remove();\r",
                    "        store.resumeAutoSync();\r",
                    "        store.sync();\r",
                    "        Ext.getCmp(\"addPageBtn\").enable();\r",
                    "        Ext.getCmp(\"removePageBtn\").disable();\r",
                    "        Ext.Array.forEach(Ext.getCmp(\"contributionPages\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btn){btn.disable();});\r",
                    "        Ext.getCmp(\"mainPageEdition\").removeAll();\r",
                    "        Ext.getCmp('delConfirmZ').close();\r",
                    "        me.resetInterface();\r",
                    "    });  \r",
                    "\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#removePageBtn"
            },
            "designerId": "054b6624-59d6-425e-8c55-a8dc5ed95e57"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "pageSelect",
                "fn": "pageSelect",
                "implHandler": [
                    "var me=this;\r",
                    "if (!record.isRoot()){\r",
                    "    Ext.getCmp(\"removePageBtn\").enable();\r",
                    "    Ext.Array.forEach(Ext.getCmp(\"contributionPages\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btn){btn.enable();});\r",
                    "    Ext.getCmp(\"mainPageEdition\").removeAll();\r",
                    "    me.renderPage(record.get(\"rows\"),1,Ext.getCmp(\"mainPageEdition\"));\r",
                    "    me.resetInterface();\r",
                    "    Ext.getCmp(\"mainPageAttributeForm\").enable();\r",
                    "    Ext.getCmp(\"mainPageAttributeForm\").getForm().setValues(record.getData());\r",
                    "    Ext.Ajax.request({\r",
                    "        url: 'xhr-get-page-url',\r",
                    "        params: {\r",
                    "            \"page-id\": record.get(\"id\")\r",
                    "        },\r",
                    "        success: function(response){\r",
                    "            var targetedUrl = Ext.JSON.decode(response.responseText).url;\r",
                    "            Ext.getCmp(\"pagesInternalPreview\").add(Ext.widget(\"container\",{\r",
                    "                autoEl: {\r",
                    "                    tag: 'iframe',\r",
                    "                    src: targetedUrl+\"?preview=1\"\r",
                    "                }\r",
                    "            }));\r",
                    "        },\r",
                    "        failure:function(){\r",
                    "            Ext.Msg.alert('Erreur', 'Erreur dans la récupération de l\\'url de la page');\r",
                    "        }\r",
                    "    });\r",
                    "\r",
                    "    Ext.getCmp(\"pagePreviewTextItem\").setText('Ceci est un aperçu de cette page telle que disponible en ligne en '+Ext.Date.format(new Date(), 'F j, Y, G:i '));\r",
                    "    var metaBox = Ext.getCmp(\"contributionPages\").getDockedComponent('barreMeta').getComponent('boiteBarreMeta');\r",
                    "    var values= record.getData();\r",
                    "    values.creation= Ext.Date.format(values.createTime, 'd-m-Y');\r",
                    "    values.derniereModification= Ext.Date.format(values.lastUpdateTime, 'd-m-Y');\r",
                    "    metaBox.update(values);\r",
                    "    metaBox.show();\r",
                    "} else {\r",
                    "    Ext.getCmp(\"addPageBtn\").enable();\r",
                    "    Ext.getCmp(\"removePageBtn\").disable();\r",
                    "    Ext.Array.forEach(Ext.getCmp(\"contributionPages\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btn){btn.disable();});\r",
                    "    Ext.getCmp(\"mainPageEdition\").removeAll();\r",
                    "    me.resetInterface();\r",
                    "}"
                ],
                "name": "select",
                "scope": "me",
                "designer|targetType": "Ext.tree.Panel",
                "designer|controlQuery": "#mainPageTree"
            },
            "designerId": "16f72b7e-ea83-4f98-97e0-5e5f729e2d85"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "moveElementUp",
                "fn": "moveElementUp",
                "implHandler": [
                    "var target=Ext.getCmp(Ext.getCmp('pageElementIdField').getValue());\r",
                    "if (!Ext.isEmpty(target)) {\r",
                    "    var pos = target.up().items.indexOf(target);\r",
                    "    if (pos > 0) {\r",
                    "        target.up().move(pos,pos-1);\r",
                    "    }\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#pageElementUp"
            },
            "designerId": "420ce9f1-454c-4f4c-8647-48c6790b0b34"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "moveElementDown",
                "fn": "moveElementDown",
                "implHandler": [
                    "var target=Ext.getCmp(Ext.getCmp('pageElementIdField').getValue());\r",
                    "if (!Ext.isEmpty(target)) {\r",
                    "    var pos = target.up().items.indexOf(target);\r",
                    "    target.up().move(pos,pos+1);\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#pageElementDown"
            },
            "designerId": "901daf12-1778-4e89-ac53-1b8020101121"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "deleteElement",
                "fn": "deleteElement",
                "implHandler": [
                    "var target=Ext.getCmp(Ext.getCmp('pageElementIdField').getValue());\r",
                    "target.destroy();\r",
                    "this.resetInterface();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#deletePageElement"
            },
            "designerId": "a13fbc2a-6370-487c-86d0-5d282a58dd1c"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "renderPage",
                "fn": "renderPage",
                "designer|params": [
                    "mRows",
                    "its",
                    "cible"
                ],
                "implHandler": [
                    "var me=this;\r",
                    "Ext.Array.forEach(mRows, function(row){\r",
                    "    row.id=row.id.slice(row.id.indexOf(\"pan\"));//remove after\r",
                    "\r",
                    "    if (row.id.indexOf(\"page-\")==-1) {\r",
                    "        row.id=\"page-\"+row.id;\r",
                    "    }\r",
                    "    var newRow = Ext.widget('panel', {\r",
                    "        header:false,\r",
                    "        mType:\"row\",\r",
                    "        eTitle:row.eTitle,\r",
                    "        id:row.id,\r",
                    "        responsive:row.responsive,\r",
                    "        classHTML:row.classHTML,\r",
                    "        idHTML:row.idHTML,\r",
                    "        margin:4,\r",
                    "        layout: {\r",
                    "            type: 'hbox',\r",
                    "            align: 'stretch'\r",
                    "        }\r",
                    "    });\r",
                    "    var rFlex=1;\r",
                    "    var eolWidth=12;\r",
                    "    Ext.Array.forEach(row.columns, function(column){\r",
                    "        if (column.offset>0) {\r",
                    "            newRow.add(Ext.widget('container', {\r",
                    "                flex:column.offset,\r",
                    "                style:\"{background-image:url(resources/images/stripes.png);}\"\r",
                    "            }));\r",
                    "            eolWidth=eolWidth-column.offset;\r",
                    "        }\r",
                    "        var isFinalCol=false;\r",
                    "        if (its<=0){isFinalCol=true;}\r",
                    "        column.id=column.id.slice(column.id.indexOf(\"pan\"));//remove after\r",
                    "\r",
                    "        if (column.id.indexOf(\"page-\")==-1) {\r",
                    "            column.id=\"page-\"+column.id;\r",
                    "        }\r",
                    "        var newCol=Ext.widget('panel', {\r",
                    "            header:false,\r",
                    "            flex:column.span,\r",
                    "            final:isFinalCol,\r",
                    "            mType:'col',\r",
                    "            id:column.id,\r",
                    "            eTitle:column.eTitle,\r",
                    "            responsive:column.responsive,\r",
                    "            classHTML:column.classHTML,\r",
                    "            idHTML:column.idHTML,\r",
                    "            margin:4,\r",
                    "            layout: {\r",
                    "                type: 'vbox',\r",
                    "                align: 'stretch'\r",
                    "            }\r",
                    "        });\r",
                    "        if ((its>0)&&(column.isTerminal===false)) {\r",
                    "            rFlex=Ext.Array.max([rFlex,column.rows.length]);\r",
                    "            me.masqueRestit(column.rows,its-1,newCol);    \r",
                    "        }\r",
                    "        else {\r",
                    "            if (Ext.isEmpty(column.blocks)){} else {\r",
                    "            Ext.Array.forEach(column.blocks, function(bl){\r",
                    "                bl.id=bl.id.slice(bl.id.indexOf(\"unBloc\"));//remove after\r",
                    "                if (bl.id.indexOf(\"page-\")==-1) {\r",
                    "                    bl.id=\"page-\"+bl.id;\r",
                    "                }\r",
                    "\r",
                    "                newCol.add(Ext.widget(\"unBloc\",bl));\r",
                    "            });\r",
                    "        }\r",
                    "    }\r",
                    "    eolWidth=eolWidth-column.span;\r",
                    "    newRow.add(newCol);\r",
                    "\r",
                    "});\r",
                    "newRow.add(Ext.widget(\"container\",{\r",
                    "    flex:eolWidth,\r",
                    "    itemId:\"eol\"\r",
                    "}));\r",
                    "if (Ext.isEmpty(row.height)) {\r",
                    "    newRow.flex=rFlex;\r",
                    "} else {\r",
                    "    newRow.height=row.height;\r",
                    "}\r",
                    "cible.add(newRow);  \r",
                    "\r",
                    "\r",
                    "});"
                ]
            },
            "designerId": "3cbb5b15-cb09-4ba6-8385-f01b8ab94a69"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "columnSelector",
                "fn": "columnSelector",
                "implHandler": [
                    "if ((abstractcomponent.mType==\"col\")&&((Ext.isEmpty(abstractcomponent.items.items))||(abstractcomponent.items.items[0].isXType(\"unBloc\")))){\r",
                    "    abstractcomponent.addBodyCls('contrastBorder');\r",
                    "    abstractcomponent.addBodyCls('contrastRow');\r",
                    "    abstractcomponent.getEl().on(\"mouseover\", function(e){\r",
                    "        abstractcomponent.setBorder(4);\r",
                    "        e.stopEvent();\r",
                    "    });\r",
                    "    abstractcomponent.getEl().on(\"mouseout\", function(e){\r",
                    "        abstractcomponent.setBorder(2);\r",
                    "        e.stopEvent();\r",
                    "    });\r",
                    "    abstractcomponent.getEl().on(\"click\", function(e){\r",
                    "        var prevSelected = Ext.getCmp(Ext.getCmp('pageElementIdField').getValue());\r",
                    "        if (!Ext.isEmpty(prevSelected)) {\r",
                    "            if (prevSelected.isXType(\"unBloc\")) {prevSelected.setIconCls();} else {\r",
                    "        prevSelected.removeBodyCls('selectedelement');}\r",
                    "    }\r",
                    "    abstractcomponent.addBodyCls('selectedelement');\r",
                    "    this.frame(MyPrefData.themeColor);\r",
                    "    Ext.getCmp('pageElementIdField').setValue(abstractcomponent.id);\r",
                    "    Ext.getCmp(\"newPageBloc\").enable();\r",
                    "    Ext.getCmp(\"deletePageElement\").disable();\r",
                    "    Ext.getCmp(\"pageElementUp\").disable();\r",
                    "    Ext.getCmp(\"pageElementDown\").disable();\r",
                    "    var propEdit=Ext.getCmp('pageElementPropsPanel');\r",
                    "    propEdit.removeAll();\r",
                    "    propEdit.setTitle(abstractcomponent.id.replace(\"panel\", abstractcomponent.mType));\r",
                    "    propEdit.setIconCls('editZone');\r",
                    "    e.stopEvent();\r",
                    "});\r",
                    "}"
                ],
                "name": "render",
                "scope": "me",
                "designer|targetType": "Ext.panel.Panel",
                "designer|controlQuery": "#mainPageEdition panel"
            },
            "designerId": "590c326a-45be-408d-8b0a-e3b354401fa7"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "resetInterface",
                "fn": "resetInterface",
                "implHandler": [
                    "Ext.getCmp(\"newPageBloc\").disable();\r",
                    "Ext.getCmp(\"deletePageElement\").disable();\r",
                    "Ext.getCmp(\"pageElementUp\").disable();\r",
                    "Ext.getCmp(\"pageElementDown\").disable();\r",
                    "Ext.getCmp('pageElementPropsPanel').removeAll();\r",
                    "Ext.getCmp('pageElementPropsPanel').setTitle(\"Sélectionnez un élément\");\r",
                    "Ext.getCmp('pageElementPropsPanel').setIconCls();\r",
                    "Ext.getCmp('pageElementIdField').setValue();\r",
                    "Ext.getCmp(\"pagesInternalPreview\").removeAll();\r",
                    "Ext.getCmp(\"mainPageAttributeForm\").getForm().setValues();\r",
                    "Ext.getCmp(\"mainPageAttributeForm\").disable();\r",
                    "Ext.getCmp(\"pagePreviewTextItem\").setText();\r",
                    "Ext.getCmp(\"contributionPages\").getDockedComponent('barreMeta').getComponent('boiteBarreMeta').hide();"
                ]
            },
            "designerId": "0a4fb2d5-4c36-4c28-a7fb-b362837242c5"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "showBlocAddWindow",
                "fn": "showBlocAddWindow",
                "implHandler": [
                    "Ext.widget(\"ajoutBlocFenetre\").show();\r",
                    "Ext.getCmp(\"boutonAjouterBloc\").hide();\r",
                    "Ext.getCmp(\"addPageBlocBtn\").show();\r",
                    "Ext.getCmp(\"BlocsSelectGrid\").pageMode=true;"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#newPageBloc"
            },
            "designerId": "7c7346db-dfbe-4691-ab04-fb477ab4085e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "insertBloc",
                "fn": "insertBloc",
                "implHandler": [
                    "var donnees = Ext.getCmp('BlocsSelectGrid').getSelectionModel().getLastSelected().data;\r",
                    "var nouvBloc = Ext.widget('unBloc', Ext.clone(donnees.configBasique));\r",
                    "nouvBloc.responsive={\r",
                    "    \"phone\":true,\r",
                    "    \"tablet\":true,\r",
                    "    \"desktop\":true\r",
                    "};\r",
                    "nouvBloc.canEdit=true;\r",
                    "Ext.getCmp(Ext.getCmp('pageElementIdField').getValue()).add(nouvBloc);\r",
                    "Ext.getCmp(\"ajoutBlocFenetre\").close();\r",
                    "nouvBloc.getEl().dom.click();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#addPageBlocBtn"
            },
            "designerId": "37a082a3-056b-4f6c-ba17-9503a4c3bdae"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "blocSelection",
                "fn": "blocSelection",
                "implHandler": [
                    "if (/*abstractcomponent.canEdit*/true){\r",
                    "    abstractcomponent.getEl().on(\"mouseover\", function(e){\r",
                    "        var prevSelected = Ext.getCmp(Ext.getCmp('pageElementIdField').getValue());\r",
                    "        if ((Ext.isEmpty(prevSelected))||(prevSelected.id!==abstractcomponent.id)) {\r",
                    "            abstractcomponent.setIconCls('selectBloc');\r",
                    "        }\r",
                    "        e.stopEvent();\r",
                    "    });\r",
                    "    abstractcomponent.getEl().on(\"mouseout\", function(e){\r",
                    "        var prevSelected = Ext.getCmp(Ext.getCmp('pageElementIdField').getValue());\r",
                    "        if ((Ext.isEmpty(prevSelected))||(prevSelected.id!==abstractcomponent.id)) {\r",
                    "        abstractcomponent.setIconCls();}\r",
                    "        e.stopEvent();\r",
                    "    });\r",
                    "    abstractcomponent.getEl().on(\"click\", function(e){\r",
                    "        var prevSelected = Ext.getCmp(Ext.getCmp('pageElementIdField').getValue());\r",
                    "        if (!Ext.isEmpty(prevSelected)) {\r",
                    "            if (prevSelected.isXType(\"unBloc\")) {prevSelected.setIconCls();} else {\r",
                    "        prevSelected.removeBodyCls('selectedelement');}\r",
                    "    }\r",
                    "    abstractcomponent.setIconCls('editBloc');\r",
                    "    Ext.getCmp(\"newPageBloc\").disable();\r",
                    "    Ext.getCmp(\"deletePageElement\").enable();\r",
                    "    Ext.getCmp(\"pageElementUp\").enable();\r",
                    "    Ext.getCmp(\"pageElementDown\").enable();\r",
                    "    this.frame(MyPrefData.themeColor);\r",
                    "    Ext.getCmp('pageElementIdField').setValue(abstractcomponent.id);\r",
                    "    var propEdit=Ext.getCmp('pageElementPropsPanel');\r",
                    "    propEdit.setTitle(abstractcomponent.id.replace(\"unBloc\", \"Bloc\"));\r",
                    "    propEdit.setIconCls('editBloc');\r",
                    "    propEdit.removeAll();\r",
                    "    var configSpec = Ext.widget('ConfigSpecBloc');\r",
                    "\r",
                    "\r",
                    "    configSpec.getComponent(0).add(Ext.widget('textfield',{\r",
                    "        itemId:\"eTitleField\",\r",
                    "        fieldLabel:\"Titre \",\r",
                    "        onChange:function(){\r",
                    "            if (this.isValid()){\r",
                    "                abstractcomponent.setTitle(this.getValue());\r",
                    "            }\r",
                    "        },\r",
                    "        labelWidth:60,\r",
                    "        allowBlank:false,\r",
                    "        anchor:\"100%\",\r",
                    "        margin:\"10 0 10 0\",\r",
                    "        value:abstractcomponent.title\r",
                    "    }));\r",
                    "\r",
                    "\r",
                    "\r",
                    "    /*\r",
                    "    configSpec.getComponent(0).add(Ext.widget('numberfield',{\r",
                    "    fieldLabel:\"Hauteur fluide \",\r",
                    "    onChange:function(){\r",
                    "    if(this.isValid()) {\r",
                    "    abstractcomponent.flex=this.getValue();\r",
                    "    abstractcomponent.up().doLayout();\r",
                    "    }\r",
                    "    },\r",
                    "    labelWidth:60,\r",
                    "    allowDecimals:false,\r",
                    "    allowBlank:false,\r",
                    "    minValue:1,\r",
                    "    anchor:\"100%\",\r",
                    "    margin:\"10 0 0 0\",\r",
                    "    value:abstractcomponent.flex\r",
                    "    }));\r",
                    "\r",
                    "    */\r",
                    "\r",
                    "    configSpec.getComponent(0).add(Ext.widget('checkboxgroup',{\r",
                    "        fieldLabel:\"Visibilité \",\r",
                    "        anchor:\"100%\",\r",
                    "        labelWidth:60,\r",
                    "        margin:\"0 0 10 0\",\r",
                    "        vertical:true,\r",
                    "        columns:1,\r",
                    "        items: [\r",
                    "        { boxLabel: 'Téléphone', checked:abstractcomponent.responsive.phone, handler:function(){abstractcomponent.responsive.phone=this.getValue();} },\r",
                    "        { boxLabel: 'Tablette',checked:abstractcomponent.responsive.tablet, handler:function(){abstractcomponent.responsive.tablet=this.getValue();}},\r",
                    "        { boxLabel: 'Ordinateur',checked:abstractcomponent.responsive.desktop, handler:function(){abstractcomponent.responsive.desktop=this.getValue();}}\r",
                    "        ]\r",
                    "\r",
                    "    }));  \r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "    configSpec.getComponent(1).add(Ext.widget('textfield',{\r",
                    "        itemId:\"eClassHTMLField\",\r",
                    "        fieldLabel:\"Classe HTML \",\r",
                    "        onChange:function(){\r",
                    "            if (this.isValid()){\r",
                    "                abstractcomponent.classHTML=this.getValue();\r",
                    "            }\r",
                    "        },\r",
                    "        labelWidth:60,\r",
                    "        allowBlank:true,\r",
                    "        anchor:\"100%\",\r",
                    "        margin:\"10 0 0 0\",\r",
                    "        value:abstractcomponent.classHTML\r",
                    "    }));\r",
                    "\r",
                    "\r",
                    "\r",
                    "    configSpec.getComponent(1).add(Ext.widget('textfield',{\r",
                    "        itemId:\"eidHTMLField\",\r",
                    "        fieldLabel:\"Id HTML \",\r",
                    "        onChange:function(){\r",
                    "            if (this.isValid()){\r",
                    "                abstractcomponent.idHTML=this.getValue();\r",
                    "            }\r",
                    "        },\r",
                    "        labelWidth:60,\r",
                    "        allowBlank:true,\r",
                    "        anchor:\"100%\",\r",
                    "        margin:\"10 0 0 0\",\r",
                    "        value:abstractcomponent.idHTML\r",
                    "    }));\r",
                    "\r",
                    "    configSpec.getComponent(1).add(Ext.widget('textfield',{\r",
                    "        itemId:\"urlPrefixHTMLField\",\r",
                    "        fieldLabel:\"Préfixe URL \",\r",
                    "        onChange:function(){\r",
                    "            if (this.isValid()){\r",
                    "                abstractcomponent.urlPrefix=this.getValue();\r",
                    "            }\r",
                    "        },\r",
                    "        labelWidth:60,\r",
                    "        regex :new RegExp(/^([a-z]|[1-9]|[-]){0,}$/),\r",
                    "        allowBlank:true,\r",
                    "        anchor:\"100%\",\r",
                    "        margin:\"10 0 0 0\",\r",
                    "        value:abstractcomponent.urlPrefix\r",
                    "    }));\r",
                    "\r",
                    "    var categories = Ext.clone(abstractcomponent.champsConfig.simple);\r",
                    "    for (j=0; j<categories.length; j++){\r",
                    "        var nCateg = Ext.create('Ext.form.FieldSet', {title: categories[j].categorie, collapsible:true, layout: 'anchor'});\r",
                    "\r",
                    "        var champsS = Ext.clone(categories[j].champs);\r",
                    "        for (i=0; i<champsS.length; i++) {\r",
                    "            if (champsS[i].type =='Ext.ux.TreePicker') {\r",
                    "                var filteredStore=  Ext.create(\"Ext.data.TreeStore\",{autoLoad: false,\r",
                    "                    autoSync: false,\r",
                    "                    isOptimised:true,\r",
                    "                    usedCollection:\"Pages\",\r",
                    "                    model: 'Rubedo.model.pageDataModel',\r",
                    "                    proxy: {\r",
                    "                        type: 'ajax',\r",
                    "                        api: {\r",
                    "                            create: 'pages/create',\r",
                    "                            read: 'pages/read-child',\r",
                    "                            update: 'pages/update',\r",
                    "                            destroy: 'pages/delete'\r",
                    "                        },\r",
                    "                        reader: {\r",
                    "                            type: 'json',\r",
                    "                            getResponseData: function(response) {\r",
                    "                                var data, error;\r",
                    "\r",
                    "                                try {\r",
                    "                                    data = Ext.decode(response.responseText);\r",
                    "                                    if (Ext.isDefined(data.data)){data.children=data.data;}// error fix\r",
                    "                                    return this.readRecords(data);\r",
                    "                                } catch (ex) {\r",
                    "                                    error = new Ext.data.ResultSet({\r",
                    "                                        total  : 0,\r",
                    "                                        count  : 0,\r",
                    "                                        records: [],\r",
                    "                                        success: false,\r",
                    "                                        message: ex.message\r",
                    "                                    });\r",
                    "\r",
                    "                                    this.fireEvent('exception', this, response, error);\r",
                    "                                    console.log(ex);\r",
                    "\r",
                    "                                    Ext.Logger.warn('Unable to parse the JSON returned by the server');\r",
                    "\r",
                    "                                    return error;\r",
                    "                                }\r",
                    "                            },\r",
                    "                            messageProperty: 'message'\r",
                    "                        }\r",
                    "                    },\r",
                    "                    sorters: {\r",
                    "                        property: 'orderValue'\r",
                    "                    }\r",
                    "                }); \r",
                    "\r",
                    "                filteredStore.getProxy().extraParams.filter=\"[{\\\"property\\\":\\\"site\\\",\\\"value\\\":\\\"\"+Ext.getCmp(\"mainPageTree\").getSelectionModel().getLastSelected().get(\"site\")+\"\\\"}]\";\r",
                    "                filteredStore.load();\r",
                    "                champsS[i].config.store= filteredStore;\r",
                    "                champsS[i].config.displayField=\"text\";\r",
                    "\r",
                    "\r",
                    "\r",
                    "            }  \r",
                    "            var nChampS = Ext.create(champsS[i].type, champsS[i].config);\r",
                    "            if (champsS[i].type =='Ext.form.field.Trigger'){\r",
                    "                var Ouvrir = Ext.clone(champsS[i].ouvrir);\r",
                    "                var targeting=Ext.clone(nChampS.id);\r",
                    "                nChampS.onTriggerClick= function() {\r",
                    "                    var fenetre = Ext.widget(Ouvrir);\r",
                    "                    fenetre.show();\r",
                    "                    fenetre.mainFieldId=targeting;\r",
                    "\r",
                    "                } ;  \r",
                    "            }\r",
                    "            nChampS.labelSeparator= ' ';\r",
                    "            nChampS.anchor= '100%';   \r",
                    "            nChampS.labelWidth=60;\r",
                    "            nChampS.setValue(abstractcomponent.configBloc[nChampS.name]);\r",
                    "            if ((nChampS.isXType(\"combobox\"))&&(!nChampS.isXType(\"treepicker\"))){\r",
                    "                nChampS.getStore().fieldId=Ext.clone(nChampS.id);\r",
                    "                nChampS.getStore().fieldValue=Ext.clone(abstractcomponent.configBloc[nChampS.name]);\r",
                    "                nChampS.getStore().addListener(\"load\",function(storeThing){\r",
                    "                    Ext.getCmp(storeThing.fieldId).setValue(storeThing.fieldValue);\r",
                    "                },this,{single:true});\r",
                    "                }\r",
                    "                if (nChampS.isXType(\"treepicker\")){\r",
                    "                    nChampS.on('select', function(){abstractcomponent.configBloc[this.name]=this.getValue(); });\r",
                    "\r",
                    "                }\r",
                    "                nChampS.on('change', function(){abstractcomponent.configBloc[this.name]=this.getValue();});\r",
                    "                nCateg.add(nChampS);\r",
                    "            }\r",
                    "            configSpec.items.items[0].add(nCateg);\r",
                    "\r",
                    "        }\r",
                    "        propEdit.add(configSpec);\r",
                    "\r",
                    "\r",
                    "        if (!ACL.interfaceRights['write.ui.masks']){\r",
                    "            Ext.Array.forEach(Ext.getCmp(\"elementEditControl\").query(\"field\"), function(truc){truc.setReadOnly(true);});\r",
                    "            Ext.Array.forEach(Ext.getCmp(\"elementEditControl\").query(\"button\"), function(truc){truc.disable();});\r",
                    "        }\r",
                    "        e.stopEvent();\r",
                    "\r",
                    "    });}"
                ],
                "name": "render",
                "scope": "me",
                "designer|targetType": "UnBloc",
                "designer|controlQuery": "#mainPageEdition unBloc"
            },
            "designerId": "14fe1e98-83ce-46a5-be63-48558f1afbcb"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "savePage",
                "fn": "savePage",
                "implHandler": [
                    "if (Ext.getCmp(\"mainPageAttributeForm\").getForm().isValid()) {\r",
                    "    var editedPage=Ext.getCmp(\"mainPageTree\").getSelectionModel().getLastSelected();\r",
                    "    var newRows=Rubedo.controller.MasqueController.prototype.saveRows(Ext.getCmp(\"mainPageEdition\"));\r",
                    "    var store=Ext.getCmp(\"mainPageTree\").getStore();\r",
                    "    store.suspendAutoSync();\r",
                    "    editedPage.beginEdit();\r",
                    "    editedPage.set(\"rows\",newRows);\r",
                    "    editedPage.set(Ext.getCmp(\"mainPageAttributeForm\").getForm().getValues());\r",
                    "    editedPage.endEdit();\r",
                    "    store.resumeAutoSync();\r",
                    "    store.sync();\r",
                    "    Ext.getCmp(\"pagesInternalPreview\").removeAll();\r",
                    "    Ext.Ajax.request({\r",
                    "        url: 'xhr-get-page-url',\r",
                    "        params: {\r",
                    "            \"page-id\": editedPage.get(\"id\")\r",
                    "        },\r",
                    "        success: function(response){\r",
                    "            var targetedUrl = Ext.JSON.decode(response.responseText).url;\r",
                    "            Ext.getCmp(\"pagesInternalPreview\").add(Ext.widget(\"container\",{\r",
                    "                autoEl: {\r",
                    "                    tag: 'iframe',\r",
                    "                    src: targetedUrl+\"?preview=1\"\r",
                    "                }\r",
                    "            }));\r",
                    "        },\r",
                    "        failure:function(){\r",
                    "            Ext.Msg.alert('Erreur', 'Erreur dans la récupération de l\\'url de la page');\r",
                    "        }\r",
                    "    });\r",
                    "} else {\r",
                    "    Ext.getCmp(\"mainPageAttributeForm\").up().setActiveTab(1);\r",
                    "    Ext.Msg.alert(\"Erreur\", \"Les propriérés de la page sont invalides.\");\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#pageSaveBtn"
            },
            "designerId": "b1fb801d-af5e-43a7-b7f8-56799de85ce4"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onWindowBeforeDestroy",
                "fn": "onWindowBeforeDestroy",
                "implHandler": [
                    "if (abstractcomponent.isXType(\"window\")){\r",
                    "    Ext.getStore(\"MasksComboStore\").removeAll();\r",
                    "    Ext.getStore(\"PagesDataStore\").getProxy().extraParams.filter=\"[{\\\"property\\\":\\\"site\\\",\\\"value\\\":\\\"emptyDecoy\\\"}]\";\r",
                    "    Ext.getStore(\"PagesDataStore\").load();\r",
                    "}"
                ],
                "name": "beforedestroy",
                "scope": "me",
                "designer|targetType": "Ext.window.Window",
                "designer|controlQuery": "#contributionPages"
            },
            "designerId": "6120f6e7-46b7-410a-971d-e8c79c4f2e57"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onPagesSitesComboBeforeRender",
                "fn": "onPagesSitesComboBeforeRender",
                "implHandler": [
                    "var me=this;\r",
                    "abstractcomponent.getStore().addListener(\"load\",function(store,records){\r",
                    "    abstractcomponent.select(records[0]);\r",
                    "    if (abstractcomponent.id==\"previewSitesCombo\"){\r",
                    "        me.pagePreviewSelect(abstractcomponent, [records[0]]);\r",
                    "    } else {\r",
                    "        me.pageSiteSelect(abstractcomponent, [records[0]]);\r",
                    "    }\r",
                    "},this,{single:true});"
                ],
                "name": "beforerender",
                "scope": "me",
                "designer|targetType": "Ext.form.field.ComboBox",
                "designer|controlQuery": "#pagesSitesCombo, #previewSitesCombo"
            },
            "designerId": "fed768ea-12ff-49c5-8386-55e42679392e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "pagePreviewSelect",
                "fn": "pagePreviewSelect",
                "implHandler": [
                    "Ext.getStore(\"PagesPreviewStore\").getProxy().extraParams.filter=\"[{\\\"property\\\":\\\"site\\\",\\\"value\\\":\\\"\"+records[0].get(\"id\")+\"\\\"}]\";\r",
                    "Ext.getStore(\"PagesPreviewStore\").load();\r",
                    "Ext.getCmp(\"contribPreviewMain\").removeAll();"
                ],
                "name": "select",
                "scope": "me",
                "designer|targetType": "Ext.form.field.ComboBox",
                "designer|controlQuery": "#previewSitesCombo"
            },
            "designerId": "7d7ddd9d-d877-4060-9865-9fec1199851e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onPreviewPageTreeSelect",
                "fn": "onPreviewPageTreeSelect",
                "implHandler": [
                    "Ext.getCmp(\"contribPreviewMain\").removeAll();\r",
                    "if(!record.isRoot()){\r",
                    "    Ext.Ajax.request({\r",
                    "        url: 'xhr-get-page-url',\r",
                    "        params: {\r",
                    "            \"page-id\": record.get(\"id\")\r",
                    "        },\r",
                    "        success: function(response){\r",
                    "            var targetedUrl = Ext.JSON.decode(response.responseText).url;\r",
                    "            Ext.getCmp(\"contribPreviewMain\").add(Ext.widget(\"container\",{\r",
                    "                autoEl: {\r",
                    "                    tag: 'iframe',\r",
                    "                    src: \"resources/responsiveShow/?url=\"+targetedUrl+\"?preview=1\"\r",
                    "                }\r",
                    "            }));\r",
                    "        },\r",
                    "        failure:function(){\r",
                    "            Ext.Msg.alert('Erreur', 'Erreur dans la récupération de l\\'url de la page');\r",
                    "        }\r",
                    "    });\r",
                    "}"
                ],
                "name": "select",
                "scope": "me",
                "designer|targetType": "Ext.tree.Panel",
                "designer|controlQuery": "#previewPageTree"
            },
            "designerId": "56a373a5-6913-4cda-b321-5fb604f616bd"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onPagePreviewRefreshBtnClick",
                "fn": "onPagePreviewRefreshBtnClick",
                "implHandler": [
                    "var record = Ext.getCmp(\"mainPageTree\").getSelectionModel().getLastSelected();\r",
                    "if ((!Ext.isEmpty(record))&&(!record.isRoot())){\r",
                    "    Ext.getCmp(\"pagesInternalPreview\").removeAll();\r",
                    "    Ext.Ajax.request({\r",
                    "        url: 'xhr-get-page-url',\r",
                    "        params: {\r",
                    "            \"page-id\": record.get(\"id\")\r",
                    "        },\r",
                    "        success: function(response){\r",
                    "            var targetedUrl = Ext.JSON.decode(response.responseText).url;\r",
                    "            Ext.getCmp(\"pagesInternalPreview\").add(Ext.widget(\"container\",{\r",
                    "                autoEl: {\r",
                    "                    tag: 'iframe',\r",
                    "                    src: targetedUrl+\"?preview=1\"\r",
                    "                }\r",
                    "            }));\r",
                    "        },\r",
                    "        failure:function(){\r",
                    "            Ext.Msg.alert('Erreur', 'Erreur dans la récupération de l\\'url de la page');\r",
                    "        }\r",
                    "    });\r",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#pagePreviewRefreshBtn"
            },
            "designerId": "c918931f-c27c-4264-9d18-6cc8b64eb2c2"
        }
    ]
}