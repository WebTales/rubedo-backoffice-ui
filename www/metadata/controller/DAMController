{
    "type": "controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "DAMController",
        "designer|userAlias": "DAMController"
    },
    "id": "ExtBox1-ext-gen19013",
    "designerId": "be2b5e1d-97ad-4d34-bac5-6baea7859c11",
    "cn": [
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "resetInterfaceSelect",
                "fn": "resetInterfaceSelect",
                "designer|params": [
                    "record"
                ],
                "implHandler": [
                    "var me =this;\r",
                    "Ext.getCmp(\"addDAMBtn\").enable();\r",
                    "Ext.Array.forEach(Ext.getCmp(\"DAMInterface\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btng){btng.enable();});\r",
                    "Ext.getCmp(\"DAMInterface\").getComponent(\"breadcrumb\").removeAll();\r",
                    "Ext.getCmp(\"DAMInterface\").getComponent(\"breadcrumb\").add(Ext.widget(\"button\", {text: \"Mèdiathéque <b> > </b>\", iconCls:\"mediaTypes\"}));\r",
                    "Ext.getCmp(\"DAMInterface\").getComponent(\"breadcrumb\").add(Ext.widget(\"button\", {text: record.get(\"type\"), iconCls:\"folder\"}));\r",
                    "Ext.getStore(\"DAMStore\").getProxy().extraParams.filter=\"[{\\\"property\\\":\\\"typeId\\\",\\\"value\\\":\\\"\"+record.get(\"id\")+\"\\\"}]\";\r",
                    "Ext.getStore(\"DAMStore\").load();\r",
                    ""
                ]
            },
            "designerId": "0ef724d8-3feb-47fe-909f-82b69ff25e50"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "resetInterfaceNoSelect",
                "fn": "resetInterfaceNoSelect",
                "implHandler": [
                    "Ext.Array.forEach(Ext.getCmp(\"DAMInterface\").getComponent(\"contextBar\").query(\"buttongroup\"), function(btng){btng.disable();});\r",
                    "Ext.getCmp(\"DAMInterface\").getComponent(\"breadcrumb\").removeAll();\r",
                    "Ext.getCmp(\"DAMInterface\").getComponent(\"breadcrumb\").add(Ext.widget(\"button\", {text: \"Types de médias\", iconCls:\"mediaTypes\"}));\r",
                    "Ext.getCmp(\"addDAMBtn\").disable();\r",
                    ""
                ]
            },
            "designerId": "8b1bb213-2eb0-46f6-ab5f-4364e1832f7e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onGridpanelSelectionChange",
                "fn": "onGridpanelSelectionChange",
                "implHandler": [
                    "if (Ext.isEmpty(selections)){\r",
                    "    this.resetInterfaceNoSelect();\r",
                    "} else {\r",
                    "    this.resetInterfaceSelect(selections[0]);\r",
                    "}"
                ],
                "name": "selectionchange",
                "scope": "me",
                "designer|targetType": "Ext.grid.Panel",
                "designer|controlQuery": "#DAMMTGrid"
            },
            "designerId": "523b4c13-412e-4438-9b57-e4d00a3ec826"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "renderDAMTypeFields",
                "fn": "renderDAMTypeFields",
                "designer|params": [
                    "DAMType"
                ],
                "implHandler": [
                    "var me=this;\r",
                    "var fieldBox=Ext.getCmp(\"DAMFieldBox\");\r",
                    "Ext.Array.forEach(DAMType.get(\"fields\"),function(field){\r",
                    "    me.renderMTField(field, fieldBox);\r",
                    "});"
                ]
            },
            "designerId": "899d0fcf-8b27-47d1-8d29-78c1784ca4de"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "renderMTField",
                "fn": "renderMTField",
                "designer|params": [
                    "protoData",
                    "renderTarget"
                ],
                "implHandler": [
                    "var me=this;\r",
                    "var configurator=protoData.config;\r",
                    "if (protoData.cType == 'combobox') {\r",
                    "    var myStore=  Ext.create('Ext.data.Store', Ext.clone(protoData.config.store));\r",
                    "    configurator.store = myStore;\r",
                    "}\r",
                    "var newField= Ext.create(protoData.cType, configurator);\r",
                    "newField.config=protoData.config;\r",
                    "newField.protoId=protoData.protoId;\r",
                    "newField.configFields=Ext.getStore(\"MTFieldsStore\").findRecord(\"id\", protoData.protoId).get(\"configFields\");\r",
                    "newField.cType=protoData.cType;\r",
                    "newField.anchor = '90%';\r",
                    "newField.style = '{float:left;}';\r",
                    "var casing =Ext.widget('ChampTC');\r",
                    "casing.add(newField);\r",
                    "casing.getComponent('helpBouton').setTooltip(newField.config.tooltip);\r",
                    "if (Ext.isEmpty(newField.config.tooltip)){\r",
                    "    casing.getComponent('helpBouton').hidden=true;\r",
                    "} \r",
                    "renderTarget.insert(renderTarget.items.items.length-2,casing);"
                ]
            },
            "designerId": "2092c93a-ac01-475b-ba80-2011248055db"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onAddDAMBtnClick",
                "fn": "onAddDAMBtnClick",
                "implHandler": [
                    "var DAMType= Ext.getCmp(\"DAMMTGrid\").getSelectionModel().getLastSelected();\r",
                    "var myEditor = Ext.widget(\"DAMCreateUpdateWindow\");\r",
                    "myEditor.show();\r",
                    "this.renderDAMTypeFields(DAMType);\r",
                    "this.renderTaxoFields(DAMType);"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#addDAMBtn"
            },
            "designerId": "d4294581-6975-44d3-a7b8-48c808aabda5"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "renderTaxoFields",
                "fn": "renderTaxoFields",
                "designer|params": [
                    "DAMType"
                ],
                "implHandler": [
                    "var formTaxoTC =  Ext.getCmp('DAMTaxoBox');\r",
                    "var lesTaxo = DAMType.get(\"vocabularies\");\r",
                    "var i=0;\r",
                    "for (i=0; i<lesTaxo.length; i++) {\r",
                    "    var leVocab = Ext.getStore('TaxonomyForDAM').findRecord('id', lesTaxo[i]);\r",
                    "    var storeT = Ext.create('Ext.data.JsonStore', {\r",
                    "        model:\"Rubedo.model.taxonomyTermModel\",\r",
                    "        remoteFilter:\"true\",\r",
                    "        proxy: {\r",
                    "            type: 'ajax',\r",
                    "            api: {\r",
                    "                read: 'taxonomy-terms'\r",
                    "            },\r",
                    "            reader: {\r",
                    "                type: 'json',\r",
                    "                messageProperty: 'message',\r",
                    "                root: 'data'\r",
                    "            },\r",
                    "            encodeFilters: function(filters) {\r",
                    "                var min = [],\r",
                    "                length = filters.length,\r",
                    "                i = 0;\r",
                    "\r",
                    "                for (; i < length; i++) {\r",
                    "                    min[i] = {\r",
                    "                        property: filters[i].property,\r",
                    "                        value   : filters[i].value\r",
                    "                    };\r",
                    "                    if (filters[i].type) {\r",
                    "                        min[i].type = filters[i].type;\r",
                    "                    }\r",
                    "                    if (filters[i].operator) {\r",
                    "                        min[i].operator = filters[i].operator;\r",
                    "                    }\r",
                    "                }\r",
                    "                return this.applyEncoding(min);\r",
                    "            }\r",
                    "        },\r",
                    "        filters: {\r",
                    "            property: 'vocabularyId',\r",
                    "            value: leVocab.get(\"id\")\r",
                    "        }\r",
                    "\r",
                    "    });\r",
                    "    storeT.on(\"beforeload\", function(s,o){\r",
                    "        o.filters=Ext.Array.slice(o.filters,0,1);\r",
                    "        if (!Ext.isEmpty(o.params.comboQuery)){\r",
                    "\r",
                    "            var newFilter=Ext.create('Ext.util.Filter', {\r",
                    "                property:\"text\",\r",
                    "                value:o.params.comboQuery,\r",
                    "                operator:'like'\r",
                    "            });\r",
                    "\r",
                    "            o.filters.push(newFilter);\r",
                    "\r",
                    "        }\r",
                    "\r",
                    "\r",
                    "    });\r",
                    "\r",
                    "\r",
                    "    var selecteur = Ext.widget('comboboxselect', {\r",
                    "        name:leVocab.get(\"id\"),\r",
                    "        width:690,\r",
                    "        fieldLabel: leVocab.get(\"name\"),\r",
                    "        autoScroll: false,\r",
                    "        store: storeT,\r",
                    "        queryMode: 'remote',\r",
                    "        queryParam: 'comboQuery',\r",
                    "        minChars:3,\r",
                    "        displayField: 'text',\r",
                    "        valueField: 'id',\r",
                    "        filterPickList: true,\r",
                    "        typeAhead: true,\r",
                    "        forceSelection: !leVocab.data.expandable,\r",
                    "        createNewOnEnter: leVocab.data.expandable,\r",
                    "        multiSelect: leVocab.data.multiSelect,\r",
                    "        allowBlank: !leVocab.data.mandatory\r",
                    "    });\r",
                    "    var enrobage =Ext.widget('ChampTC');\r",
                    "    enrobage.add(selecteur);\r",
                    "    enrobage.getComponent('helpBouton').setTooltip(leVocab.data.helpText);\r",
                    "    formTaxoTC.add(enrobage);\r",
                    "\r",
                    "}"
                ]
            },
            "designerId": "d1ba1045-af86-4901-9aa5-c79962ca4a7d"
        }
    ]
}